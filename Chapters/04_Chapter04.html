

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Chapter 04 - Linear Models &#8212; Statistical Rethinking in Pyro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/jupyter-sphinx.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/mystnb.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Chapter 05 - Multivariate Linear Models" href="05_Chapter05.html" />
    <link rel="prev" title="Chapter 03 - Sampling the Imaginary" href="03_Chapter03.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  
  <h1 class="site-logo" id="site-title">Statistical Rethinking in Pyro</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  
  <ul class="nav sidenav_l1">
  <li class="">
    <a href="../intro.html">Statistical Rethinking with Pyro</a>
  </li>
  <li class="">
    <a href="02_Chapter02.html">Chapter 02 - Small Worlds and Large Worlds</a>
  </li>
  <li class="">
    <a href="03_Chapter03.html">Chapter 03 - Sampling the Imaginary</a>
  </li>
  <li class="active">
    <a href="">Chapter 04 - Linear Models</a>
  </li>
  <li class="">
    <a href="05_Chapter05.html">Chapter 05 - Multivariate Linear Models</a>
  </li>
</ul>
</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/Chapters/04_Chapter04.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

    </div>
    <div class="d-none d-md-block col-md-2 bd-toc show">
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#" class="nav-link">Chapter 04 - Linear Models</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-1" class="nav-link">Code 4.1</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-2" class="nav-link">Code 4.2</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-3" class="nav-link">Code 4.3</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-4" class="nav-link">Code 4.4</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-5" class="nav-link">Code 4.5</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-6" class="nav-link">Code 4.6</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-7" class="nav-link">Code 4.7</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-8" class="nav-link">Code 4.8</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-9" class="nav-link">Code 4.9</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-10" class="nav-link">Code 4.10</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-11" class="nav-link">Code 4.11</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-12" class="nav-link">Code 4.12</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-13" class="nav-link">Code 4.13</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-14" class="nav-link">Code 4.14</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-15" class="nav-link">Code 4.15</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-16" class="nav-link">Code 4.16</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-17" class="nav-link">Code 4.17</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-18" class="nav-link">Code 4.18</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-19" class="nav-link">Code 4.19</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-20" class="nav-link">Code 4.20</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-21" class="nav-link">Code 4.21</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-22" class="nav-link">Code 4.22</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-23" class="nav-link">Code 4.23</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-24" class="nav-link">Code 4.24</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-25" class="nav-link">Code 4.25</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-26" class="nav-link">Code 4.26</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-27" class="nav-link">Code 4.27</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-28" class="nav-link">Code 4.28</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-29" class="nav-link">Code 4.29</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-30" class="nav-link">Code 4.30</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-31" class="nav-link">Code 4.31</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-32" class="nav-link">Code 4.32</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-33" class="nav-link">Code 4.33</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-34" class="nav-link">Code 4.34</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-35" class="nav-link">Code 4.35</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-36" class="nav-link">Code 4.36</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-37" class="nav-link">Code 4.37</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-38" class="nav-link">Code 4.38</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-39" class="nav-link">Code 4.39</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-40" class="nav-link">Code 4.40</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-41" class="nav-link">Code 4.41</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-42" class="nav-link">Code 4.42</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-43" class="nav-link">Code 4.43</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-44" class="nav-link">Code 4.44</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-45" class="nav-link">Code 4.45</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-46" class="nav-link">Code 4.46</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-47" class="nav-link">Code 4.47</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-48" class="nav-link">Code 4.48</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-49" class="nav-link">Code 4.49</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-50" class="nav-link">Code 4.50</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-51" class="nav-link">Code 4.51</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-52" class="nav-link">Code 4.52</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-53" class="nav-link">Code 4.53</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-54" class="nav-link">Code 4.54</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-55" class="nav-link">Code 4.55</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-56" class="nav-link">Code 4.56</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-57" class="nav-link">Code 4.57</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-58" class="nav-link">Code 4.58</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-59" class="nav-link">Code 4.59</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-60" class="nav-link">Code 4.60</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-61" class="nav-link">Code 4.61</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-62" class="nav-link">Code 4.62</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-63" class="nav-link">Code 4.63</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-64" class="nav-link">Code 4.64</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-65" class="nav-link">Code 4.65</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-66" class="nav-link">Code 4.66</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-67" class="nav-link">Code 4.67</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-68" class="nav-link">Code 4.68</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-69" class="nav-link">Code 4.69</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-70" class="nav-link">Code 4.70</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-71" class="nav-link">Code 4.71</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#code-4-72" class="nav-link">Code 4.72</a>
        </li>
    
    </ul>
</nav>


    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <p><a href="https://colab.research.google.com/github/saketkc/pyro-rethinking/blob/master/Chapters/04_Chapter04.ipynb" target="_parent"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"/></a></p>
<div class="section" id="chapter-04-linear-models">
<h1>Chapter 04 - Linear Models<a class="headerlink" href="#chapter-04-linear-models" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!pip install torch torchvision pyro-ppl proplot black blackcellmagic
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: torch in /opt/hostedtoolcache/Python/3.7.7/x64/lib/python3.7/site-packages (1.5.1)
Requirement already satisfied: torchvision in /opt/hostedtoolcache/Python/3.7.7/x64/lib/python3.7/site-packages (0.6.1)
Requirement already satisfied: pyro-ppl in /opt/hostedtoolcache/Python/3.7.7/x64/lib/python3.7/site-packages (1.3.1)
</pre></div>
</div>
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: proplot in /opt/hostedtoolcache/Python/3.7.7/x64/lib/python3.7/site-packages (0.6.4)
Requirement already satisfied: black in /opt/hostedtoolcache/Python/3.7.7/x64/lib/python3.7/site-packages (19.10b0)
</pre></div>
</div>
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: blackcellmagic in /opt/hostedtoolcache/Python/3.7.7/x64/lib/python3.7/site-packages (0.0.2)
Requirement already satisfied: future in /opt/hostedtoolcache/Python/3.7.7/x64/lib/python3.7/site-packages (from torch) (0.18.2)
Requirement already satisfied: numpy in /opt/hostedtoolcache/Python/3.7.7/x64/lib/python3.7/site-packages (from torch) (1.19.0)
Requirement already satisfied: pillow&gt;=4.1.1 in /opt/hostedtoolcache/Python/3.7.7/x64/lib/python3.7/site-packages (from torchvision) (7.2.0)
Requirement already satisfied: pyro-api&gt;=0.1.1 in /opt/hostedtoolcache/Python/3.7.7/x64/lib/python3.7/site-packages (from pyro-ppl) (0.1.2)
Requirement already satisfied: tqdm&gt;=4.36 in /opt/hostedtoolcache/Python/3.7.7/x64/lib/python3.7/site-packages (from pyro-ppl) (4.47.0)
Requirement already satisfied: opt-einsum&gt;=2.3.2 in /opt/hostedtoolcache/Python/3.7.7/x64/lib/python3.7/site-packages (from pyro-ppl) (3.2.1)
Requirement already satisfied: matplotlib in /opt/hostedtoolcache/Python/3.7.7/x64/lib/python3.7/site-packages (from proplot) (3.2.2)
</pre></div>
</div>
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: typed-ast&gt;=1.4.0 in /opt/hostedtoolcache/Python/3.7.7/x64/lib/python3.7/site-packages (from black) (1.4.1)
Requirement already satisfied: regex in /opt/hostedtoolcache/Python/3.7.7/x64/lib/python3.7/site-packages (from black) (2020.6.8)
Requirement already satisfied: pathspec&lt;1,&gt;=0.6 in /opt/hostedtoolcache/Python/3.7.7/x64/lib/python3.7/site-packages (from black) (0.8.0)
Requirement already satisfied: appdirs in /opt/hostedtoolcache/Python/3.7.7/x64/lib/python3.7/site-packages (from black) (1.4.4)
Requirement already satisfied: toml&gt;=0.9.4 in /opt/hostedtoolcache/Python/3.7.7/x64/lib/python3.7/site-packages (from black) (0.10.1)
Requirement already satisfied: attrs&gt;=18.1.0 in /opt/hostedtoolcache/Python/3.7.7/x64/lib/python3.7/site-packages (from black) (19.3.0)
Requirement already satisfied: click&gt;=6.5 in /opt/hostedtoolcache/Python/3.7.7/x64/lib/python3.7/site-packages (from black) (7.1.2)
Requirement already satisfied: ipython in /opt/hostedtoolcache/Python/3.7.7/x64/lib/python3.7/site-packages (from blackcellmagic) (7.16.1)
</pre></div>
</div>
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: cycler&gt;=0.10 in /opt/hostedtoolcache/Python/3.7.7/x64/lib/python3.7/site-packages (from matplotlib-&gt;proplot) (0.10.0)
Requirement already satisfied: pyparsing!=2.0.4,!=2.1.2,!=2.1.6,&gt;=2.0.1 in /opt/hostedtoolcache/Python/3.7.7/x64/lib/python3.7/site-packages (from matplotlib-&gt;proplot) (2.4.7)
Requirement already satisfied: kiwisolver&gt;=1.0.1 in /opt/hostedtoolcache/Python/3.7.7/x64/lib/python3.7/site-packages (from matplotlib-&gt;proplot) (1.2.0)
Requirement already satisfied: python-dateutil&gt;=2.1 in /opt/hostedtoolcache/Python/3.7.7/x64/lib/python3.7/site-packages (from matplotlib-&gt;proplot) (2.8.1)
Requirement already satisfied: jedi&gt;=0.10 in /opt/hostedtoolcache/Python/3.7.7/x64/lib/python3.7/site-packages (from ipython-&gt;blackcellmagic) (0.17.1)
Requirement already satisfied: setuptools&gt;=18.5 in /opt/hostedtoolcache/Python/3.7.7/x64/lib/python3.7/site-packages (from ipython-&gt;blackcellmagic) (41.2.0)
</pre></div>
</div>
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: prompt-toolkit!=3.0.0,!=3.0.1,&lt;3.1.0,&gt;=2.0.0 in /opt/hostedtoolcache/Python/3.7.7/x64/lib/python3.7/site-packages (from ipython-&gt;blackcellmagic) (3.0.5)
Requirement already satisfied: decorator in /opt/hostedtoolcache/Python/3.7.7/x64/lib/python3.7/site-packages (from ipython-&gt;blackcellmagic) (4.4.2)
Requirement already satisfied: backcall in /opt/hostedtoolcache/Python/3.7.7/x64/lib/python3.7/site-packages (from ipython-&gt;blackcellmagic) (0.2.0)
Requirement already satisfied: pygments in /opt/hostedtoolcache/Python/3.7.7/x64/lib/python3.7/site-packages (from ipython-&gt;blackcellmagic) (2.6.1)
Requirement already satisfied: pickleshare in /opt/hostedtoolcache/Python/3.7.7/x64/lib/python3.7/site-packages (from ipython-&gt;blackcellmagic) (0.7.5)
Requirement already satisfied: pexpect; sys_platform != &quot;win32&quot; in /opt/hostedtoolcache/Python/3.7.7/x64/lib/python3.7/site-packages (from ipython-&gt;blackcellmagic) (4.8.0)
Requirement already satisfied: traitlets&gt;=4.2 in /opt/hostedtoolcache/Python/3.7.7/x64/lib/python3.7/site-packages (from ipython-&gt;blackcellmagic) (4.3.3)
Requirement already satisfied: six in /opt/hostedtoolcache/Python/3.7.7/x64/lib/python3.7/site-packages (from cycler&gt;=0.10-&gt;matplotlib-&gt;proplot) (1.15.0)
Requirement already satisfied: parso&lt;0.8.0,&gt;=0.7.0 in /opt/hostedtoolcache/Python/3.7.7/x64/lib/python3.7/site-packages (from jedi&gt;=0.10-&gt;ipython-&gt;blackcellmagic) (0.7.0)
Requirement already satisfied: wcwidth in /opt/hostedtoolcache/Python/3.7.7/x64/lib/python3.7/site-packages (from prompt-toolkit!=3.0.0,!=3.0.1,&lt;3.1.0,&gt;=2.0.0-&gt;ipython-&gt;blackcellmagic) (0.2.5)
Requirement already satisfied: ptyprocess&gt;=0.5 in /opt/hostedtoolcache/Python/3.7.7/x64/lib/python3.7/site-packages (from pexpect; sys_platform != &quot;win32&quot;-&gt;ipython-&gt;blackcellmagic) (0.6.0)
Requirement already satisfied: ipython-genutils in /opt/hostedtoolcache/Python/3.7.7/x64/lib/python3.7/site-packages (from traitlets&gt;=4.2-&gt;ipython-&gt;blackcellmagic) (0.2.0)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">load_ext</span> <span class="n">blackcellmagic</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">proplot</span> <span class="k">as</span> <span class="nn">plot</span>
<span class="kn">import</span> <span class="nn">pyro</span>
<span class="kn">import</span> <span class="nn">pyro.distributions</span> <span class="k">as</span> <span class="nn">dist</span>
<span class="kn">import</span> <span class="nn">pyro.infer</span>
<span class="kn">import</span> <span class="nn">pyro.ops.stats</span> <span class="k">as</span> <span class="nn">stats</span>
<span class="kn">import</span> <span class="nn">pyro.optim</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torch.distributions.constraints</span> <span class="k">as</span> <span class="nn">constraints</span>
<span class="kn">import</span> <span class="nn">torch.tensor</span> <span class="k">as</span> <span class="nn">tensor</span>
<span class="kn">from</span> <span class="nn">pyro.contrib.autoguide</span> <span class="kn">import</span> <span class="n">AutoLaplaceApproximation</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
<span class="o">%</span><span class="n">pylab</span> <span class="n">inline</span>
<span class="n">pyro</span><span class="o">.</span><span class="n">set_rng_seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;axes.labelweight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;bold&quot;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;font.weight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;bold&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>Populating the interactive namespace from numpy and matplotlib
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="code-4-1">
<h1>Code 4.1<a class="headerlink" href="#code-4-1" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Normal by addition</span>
<span class="n">pos</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">1.</span><span class="p">))</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">16</span><span class="p">]))</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">pos</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;position&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Density&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;16 steps&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04_Chapter04_5_0.png" src="../_images/04_Chapter04_5_0.png" />
</div>
</div>
</div>
<div class="section" id="code-4-2">
<h1>Code 4.2<a class="headerlink" href="#code-4-2" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Normal by multiplication</span>
<span class="p">(</span><span class="n">dist</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">1.</span><span class="p">))</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">12</span><span class="p">]))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">prod</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>tensor(116.2093)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="code-4-3">
<h1>Code 4.3<a class="headerlink" href="#code-4-3" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Normal by multiplication</span>

<span class="n">growth</span> <span class="o">=</span> <span class="p">(</span><span class="n">dist</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">1.</span><span class="p">))</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">10000</span><span class="p">,</span><span class="mi">12</span><span class="p">]))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">growth</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Growth&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Density&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04_Chapter04_9_0.png" src="../_images/04_Chapter04_9_0.png" />
</div>
</div>
</div>
<div class="section" id="code-4-4">
<h1>Code 4.4<a class="headerlink" href="#code-4-4" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Normal by multiplication</span>

<span class="n">big</span> <span class="o">=</span> <span class="p">(</span><span class="n">dist</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="p">))</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">10000</span><span class="p">,</span><span class="mi">12</span><span class="p">]))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">small</span> <span class="o">=</span> <span class="p">(</span><span class="n">dist</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="o">.</span><span class="mi">01</span><span class="p">))</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">10000</span><span class="p">,</span><span class="mi">12</span><span class="p">]))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">big</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;big&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Growth&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Density&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">small</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;small&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Growth&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Density&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04_Chapter04_11_0.png" src="../_images/04_Chapter04_11_0.png" />
</div>
</div>
</div>
<div class="section" id="code-4-5">
<h1>Code 4.5<a class="headerlink" href="#code-4-5" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Normal by log-multiplication</span>

<span class="n">log_big</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">log</span><span class="p">((</span><span class="n">dist</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="p">))</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">10000</span><span class="p">,</span><span class="mi">12</span><span class="p">]))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">log_big</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="c1">#ax.set_xlabel(&quot;Growth&quot;)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Density&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04_Chapter04_13_0.png" src="../_images/04_Chapter04_13_0.png" />
</div>
</div>
</div>
<div class="section" id="code-4-6">
<h1>Code 4.6<a class="headerlink" href="#code-4-6" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">w</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">9</span>
<span class="n">p_grid</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">prior</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">([</span><span class="mf">1.0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">posterior</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">Binomial</span><span class="p">(</span><span class="n">total_count</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">probs</span><span class="o">=</span><span class="n">p_grid</span><span class="p">)</span><span class="o">.</span><span class="n">log_prob</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">w</span><span class="p">)))</span><span class="o">.</span><span class="n">exp</span><span class="p">()</span> <span class="o">*</span> <span class="n">dist</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">log_prob</span><span class="p">(</span><span class="n">p_grid</span><span class="p">)</span><span class="o">.</span><span class="n">exp</span><span class="p">()</span>
<span class="n">posterior</span> <span class="o">=</span> <span class="n">posterior</span><span class="o">/</span><span class="n">posterior</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="code-4-7">
<h1>Code 4.7<a class="headerlink" href="#code-4-7" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!wget -c https://raw.githubusercontent.com/rmcelreath/rethinking/master/data/Howell1.csv
howell = pd.read_csv(&quot;Howell1.csv&quot;, sep=&quot;;&quot;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>--2020-07-05 01:50:23--  https://raw.githubusercontent.com/rmcelreath/rethinking/master/data/Howell1.csv
Resolving raw.githubusercontent.com (raw.githubusercontent.com)... 
</pre></div>
</div>
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>151.101.248.133
Connecting to raw.githubusercontent.com (raw.githubusercontent.com)|151.101.248.133|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 12205 (12K) [text/plain]
Saving to: ‘Howell1.csv’


Howell1.csv           0%[                    ]       0  --.-KB/s               
Howell1.csv         100%[===================&gt;]  11.92K  --.-KB/s    in 0s      

2020-07-05 01:50:23 (25.3 MB/s) - ‘Howell1.csv’ saved [12205/12205]

</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="code-4-8">
<h1>Code 4.8<a class="headerlink" href="#code-4-8" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">howell</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>height</th>
      <th>weight</th>
      <th>age</th>
      <th>male</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>151.765</td>
      <td>47.825606</td>
      <td>63.0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>139.700</td>
      <td>36.485807</td>
      <td>63.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>136.525</td>
      <td>31.864838</td>
      <td>65.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>156.845</td>
      <td>53.041915</td>
      <td>41.0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>145.415</td>
      <td>41.276872</td>
      <td>51.0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="code-4-9">
<h1>Code 4.9<a class="headerlink" href="#code-4-9" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">howell</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>0      151.765
1      139.700
2      136.525
3      156.845
4      145.415
        ...   
539    145.415
540    162.560
541    156.210
542     71.120
543    158.750
Name: height, Length: 544, dtype: float64
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="code-4-10">
<h1>Code 4.10<a class="headerlink" href="#code-4-10" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">howell2</span> <span class="o">=</span> <span class="n">howell</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">howell</span><span class="o">.</span><span class="n">age</span><span class="o">&gt;=</span><span class="mi">18</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="code-4-11">
<h1>Code 4.11<a class="headerlink" href="#code-4-11" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mu</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="mf">178.</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">20.</span><span class="p">))</span><span class="o">.</span><span class="n">log_prob</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">100</span><span class="p">))</span><span class="o">.</span><span class="n">exp</span><span class="p">()</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">100</span><span class="p">),</span> <span class="n">mu</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Height&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Density&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04_Chapter04_25_0.png" src="../_images/04_Chapter04_25_0.png" />
</div>
</div>
</div>
<div class="section" id="code-4-12">
<h1>Code 4.12<a class="headerlink" href="#code-4-12" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sigma</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">50.</span><span class="p">))</span><span class="o">.</span><span class="n">log_prob</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">100</span><span class="p">))</span><span class="o">.</span><span class="n">exp</span><span class="p">()</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">100</span><span class="p">),</span> <span class="n">sigma</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Sigma&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Density&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04_Chapter04_27_0.png" src="../_images/04_Chapter04_27_0.png" />
</div>
</div>
</div>
<div class="section" id="code-4-13">
<h1>Code 4.13<a class="headerlink" href="#code-4-13" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sample_mu</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="mf">178.</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">20.</span><span class="p">))</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">10000</span><span class="p">]))</span>
<span class="n">sample_sigma</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">5.</span><span class="p">))</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">10000</span><span class="p">]))</span>
<span class="n">prior_h</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">sample_mu</span><span class="p">,</span> <span class="n">sample_sigma</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">10000</span><span class="p">]))</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">prior_h</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">hist</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Height (prior)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Density&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04_Chapter04_29_0.png" src="../_images/04_Chapter04_29_0.png" />
</div>
</div>
</div>
<div class="section" id="code-4-14">
<h1>Code 4.14<a class="headerlink" href="#code-4-14" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">itertools</span>
<span class="n">mu_list</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="mf">140.</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">160.</span><span class="p">),</span> <span class="n">steps</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">sigma_list</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="mf">4.</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">9.</span><span class="p">),</span> <span class="n">steps</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">post</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">mu_list</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">sigma_list</span><span class="o">.</span><span class="n">numpy</span><span class="p">()),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mu&#39;</span><span class="p">,</span> <span class="s1">&#39;sigma&#39;</span><span class="p">])</span>
<span class="n">ll</span> <span class="o">=</span> <span class="n">post</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">mu</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">sigma</span><span class="p">)</span><span class="o">.</span><span class="n">log_prob</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="n">howell2</span><span class="o">.</span><span class="n">height</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">prod</span> <span class="o">=</span>  <span class="n">tensor</span><span class="p">(</span><span class="n">ll</span><span class="p">)</span> <span class="o">+</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">tensor</span><span class="p">(</span><span class="mf">178.</span><span class="p">),</span> <span class="n">scale</span><span class="o">=</span><span class="n">tensor</span><span class="p">(</span><span class="mf">20.</span><span class="p">))</span><span class="o">.</span><span class="n">log_prob</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">mu</span><span class="o">.</span><span class="n">values</span><span class="p">))</span> <span class="o">+</span> <span class="n">dist</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">50.</span><span class="p">))</span><span class="o">.</span><span class="n">log_prob</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">sigma</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
<span class="n">post_prob</span> <span class="o">=</span> <span class="p">(</span><span class="n">prod</span> <span class="o">-</span> <span class="n">prod</span><span class="o">.</span><span class="n">max</span><span class="p">())</span><span class="o">.</span><span class="n">exp</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="code-4-15">
<h1>Code 4.15<a class="headerlink" href="#code-4-15" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">post</span><span class="p">[</span><span class="s2">&quot;mu&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span> <span class="n">post</span><span class="p">[</span><span class="s2">&quot;sigma&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span>
           <span class="n">post_prob</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">))</span>
<span class="n">fig</span><span class="p">,</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 640x480 with 1 Axes&gt;, None)
</pre></div>
</div>
<img alt="../_images/04_Chapter04_33_1.png" src="../_images/04_Chapter04_33_1.png" />
</div>
</div>
</div>
<div class="section" id="code-4-16">
<h1>Code 4.16<a class="headerlink" href="#code-4-16" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">post_prob</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 640x480 with 1 Axes&gt;, None)
</pre></div>
</div>
<img alt="../_images/04_Chapter04_35_1.png" src="../_images/04_Chapter04_35_1.png" />
</div>
</div>
</div>
<div class="section" id="code-4-17">
<h1>Code 4.17<a class="headerlink" href="#code-4-17" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># sample posterior</span>

<span class="n">sample_rows</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">multinomial</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="n">post_prob</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
                                <span class="n">replacement</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">sample_mu</span> <span class="o">=</span> <span class="n">post</span><span class="p">[</span><span class="s2">&quot;mu&quot;</span><span class="p">][</span><span class="n">sample_rows</span><span class="o">.</span><span class="n">numpy</span><span class="p">()]</span>
<span class="n">sample_sigma</span> <span class="o">=</span> <span class="n">post</span><span class="p">[</span><span class="s2">&quot;sigma&quot;</span><span class="p">][</span><span class="n">sample_rows</span><span class="o">.</span><span class="n">numpy</span><span class="p">()]</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="code-4-18">
<h1>Code 4.18<a class="headerlink" href="#code-4-18" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">sample_mu</span><span class="p">,</span> <span class="n">sample_sigma</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;mu&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;sigma&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04_Chapter04_39_0.png" src="../_images/04_Chapter04_39_0.png" />
</div>
</div>
</div>
<div class="section" id="code-4-19">
<h1>Code 4.19<a class="headerlink" href="#code-4-19" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Density&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">sample_mu</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">sample_sigma</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04_Chapter04_41_0.png" src="../_images/04_Chapter04_41_0.png" />
</div>
</div>
</div>
<div class="section" id="code-4-20">
<h1>Code 4.20<a class="headerlink" href="#code-4-20" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyro.ops.stats</span> <span class="k">as</span> <span class="nn">stats</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">hpdi</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="n">sample_mu</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="mf">0.89</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">hpdi</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="n">sample_sigma</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="mf">0.89</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>tensor([154.0704, 155.3769], dtype=torch.float64)
tensor([7.3166, 8.2462], dtype=torch.float64)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="code-4-21">
<h1>Code 4.21<a class="headerlink" href="#code-4-21" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">d3</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="n">howell2</span><span class="o">.</span><span class="n">height</span><span class="p">),</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="code-4-22">
<h1>Code 4.22<a class="headerlink" href="#code-4-22" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mu_list</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="mf">150.</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">170.</span><span class="p">),</span> <span class="n">steps</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">sigma_list</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="mf">4.</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">20.</span><span class="p">),</span> <span class="n">steps</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">post</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">mu_list</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">sigma_list</span><span class="o">.</span><span class="n">numpy</span><span class="p">()),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mu&#39;</span><span class="p">,</span> <span class="s1">&#39;sigma&#39;</span><span class="p">])</span>
<span class="n">ll</span> <span class="o">=</span> <span class="n">post</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">mu</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">sigma</span><span class="p">)</span><span class="o">.</span><span class="n">log_prob</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="n">howell2</span><span class="o">.</span><span class="n">height</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">prod</span> <span class="o">=</span>  <span class="n">tensor</span><span class="p">(</span><span class="n">ll</span><span class="p">)</span> <span class="o">+</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">tensor</span><span class="p">(</span><span class="mf">178.</span><span class="p">),</span> <span class="n">scale</span><span class="o">=</span><span class="n">tensor</span><span class="p">(</span><span class="mf">20.</span><span class="p">))</span><span class="o">.</span><span class="n">log_prob</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">mu</span><span class="o">.</span><span class="n">values</span><span class="p">))</span> <span class="o">+</span> <span class="n">dist</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">50.</span><span class="p">))</span><span class="o">.</span><span class="n">log_prob</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">sigma</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
<span class="n">post_prob</span> <span class="o">=</span> <span class="p">(</span><span class="n">prod</span> <span class="o">-</span> <span class="n">prod</span><span class="o">.</span><span class="n">max</span><span class="p">())</span><span class="o">.</span><span class="n">exp</span><span class="p">()</span>


<span class="n">sample_rows</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">multinomial</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="n">post_prob</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
                                <span class="n">replacement</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">sample2_mu</span> <span class="o">=</span> <span class="n">post</span><span class="p">[</span><span class="s2">&quot;mu&quot;</span><span class="p">][</span><span class="n">sample_rows</span><span class="o">.</span><span class="n">numpy</span><span class="p">()]</span>
<span class="n">sample2_sigma</span> <span class="o">=</span> <span class="n">post</span><span class="p">[</span><span class="s2">&quot;sigma&quot;</span><span class="p">][</span><span class="n">sample_rows</span><span class="o">.</span><span class="n">numpy</span><span class="p">()]</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">sample2_mu</span><span class="p">,</span> <span class="n">sample2_sigma</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.PathCollection at 0x7fb3b0a20990&gt;
</pre></div>
</div>
<img alt="../_images/04_Chapter04_47_1.png" src="../_images/04_Chapter04_47_1.png" />
</div>
</div>
</div>
<div class="section" id="code-4-23">
<h1>Code 4.23<a class="headerlink" href="#code-4-23" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">sample2_sigma</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">hist</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;sampled&#39;</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="n">sample2_sigma</span><span class="o">.</span><span class="n">mean</span><span class="p">()),</span> 
                <span class="n">tensor</span><span class="p">(</span><span class="n">sample2_sigma</span><span class="o">.</span><span class="n">std</span><span class="p">()))</span><span class="o">.</span><span class="n">log_prob</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="n">sample2_sigma</span><span class="o">.</span><span class="n">values</span><span class="p">))</span><span class="o">.</span><span class="n">exp</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">sample2_sigma</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Normal&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04_Chapter04_49_0.png" src="../_images/04_Chapter04_49_0.png" />
</div>
</div>
</div>
<div class="section" id="code-4-24">
<h1>Code 4.24<a class="headerlink" href="#code-4-24" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">howell2</span> <span class="o">=</span> <span class="n">howell</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">howell</span><span class="o">.</span><span class="n">age</span><span class="o">&gt;=</span><span class="mi">18</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="code-4-25">
<h1>Code 4.25<a class="headerlink" href="#code-4-25" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">model41</span><span class="p">():</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;mu&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="mf">178.</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">20.</span><span class="p">)))</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;sigma&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">50.</span><span class="p">)))</span>
    <span class="n">height</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">))</span><span class="c1">#,obs=height)</span>
    <span class="k">return</span> <span class="n">height</span> 

<span class="k">def</span> <span class="nf">guide41</span><span class="p">():</span>
    <span class="n">mu_param</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">param</span><span class="p">(</span>
        <span class="s2">&quot;mu_param&quot;</span><span class="p">,</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">140.</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">sigma_param</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">param</span><span class="p">(</span>
        <span class="s2">&quot;sigma_param&quot;</span><span class="p">,</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">20.</span><span class="p">),</span> <span class="n">constraint</span><span class="o">=</span><span class="n">constraints</span><span class="o">.</span><span class="n">positive</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;mu&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Delta</span><span class="p">(</span><span class="n">mu_param</span><span class="p">)),</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;sigma&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Delta</span><span class="p">(</span><span class="n">sigma_param</span><span class="p">))</span>

<span class="n">pyro</span><span class="o">.</span><span class="n">clear_param_store</span><span class="p">()</span>
<span class="n">conditioned41</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="n">model41</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">tensor</span><span class="p">(</span><span class="n">howell2</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)})</span>
<span class="n">svi</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">SVI</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">conditioned41</span><span class="p">,</span>
                     <span class="n">guide</span><span class="o">=</span><span class="n">guide41</span><span class="p">,</span>
                     <span class="n">optim</span><span class="o">=</span><span class="n">pyro</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">SGD</span><span class="p">({</span><span class="s2">&quot;lr&quot;</span><span class="p">:</span> <span class="mf">0.001</span><span class="p">,</span> <span class="s2">&quot;momentum&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">}),</span>
                     <span class="n">loss</span><span class="o">=</span><span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">Trace_ELBO</span><span class="p">())</span>

<span class="n">num_steps</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">losses</span> <span class="o">=</span> <span class="p">[</span><span class="n">svi</span><span class="o">.</span><span class="n">step</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_steps</span><span class="p">)]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">losses</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;ELBO&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;step&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;loss&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;mu = &quot;</span><span class="p">,</span> <span class="n">pyro</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;mu_param&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;sigma = &quot;</span><span class="p">,</span> <span class="n">pyro</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;sigma_param&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>mu =  154.60586547851562
sigma =  7.731332302093506
</pre></div>
</div>
<img alt="../_images/04_Chapter04_53_1.png" src="../_images/04_Chapter04_53_1.png" />
</div>
</div>
</div>
<div class="section" id="code-4-26">
<h1>Code 4.26<a class="headerlink" href="#code-4-26" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">prob</span><span class="o">=</span><span class="mf">0.95</span><span class="p">):</span>
    <span class="n">site_stats</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">samples</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">site_stats</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
            <span class="s2">&quot;std&quot;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
            <span class="s2">&quot;</span><span class="si">{:.1f}</span><span class="s2">%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">prob</span><span class="p">)):</span> <span class="n">v</span><span class="o">.</span><span class="n">kthvalue</span><span class="p">(</span>
                <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">prob</span><span class="p">)),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
            <span class="s2">&quot;</span><span class="si">{:.1f}</span><span class="s2">%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">prob</span><span class="p">):</span> <span class="n">v</span><span class="o">.</span><span class="n">kthvalue</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">prob</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span>
                <span class="mi">0</span>
            <span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
        <span class="p">}</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">site_stats</span><span class="p">)</span>


<span class="n">guide41_laplace</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">autoguide</span><span class="o">.</span><span class="n">AutoLaplaceApproximation</span><span class="p">(</span><span class="n">conditioned41</span><span class="p">)</span>
<span class="n">pyro</span><span class="o">.</span><span class="n">clear_param_store</span><span class="p">()</span>

<span class="n">svi</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">SVI</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">conditioned41</span><span class="p">,</span>
    <span class="n">guide</span><span class="o">=</span><span class="n">guide41_laplace</span><span class="p">,</span>
    <span class="n">optim</span><span class="o">=</span><span class="n">pyro</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">SGD</span><span class="p">({</span><span class="s2">&quot;lr&quot;</span><span class="p">:</span> <span class="mf">0.001</span><span class="p">,</span> <span class="s2">&quot;momentum&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">}),</span>
    <span class="n">loss</span><span class="o">=</span><span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">Trace_ELBO</span><span class="p">(),</span>
<span class="p">)</span>

<span class="n">num_steps</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">losses</span> <span class="o">=</span> <span class="p">[</span><span class="n">svi</span><span class="o">.</span><span class="n">step</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_steps</span><span class="p">)]</span>

<span class="n">laplace_guide41</span> <span class="o">=</span> <span class="n">guide41_laplace</span><span class="o">.</span><span class="n">laplace_approximation</span><span class="p">()</span>
<span class="n">pred41</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">Predictive</span><span class="p">(</span><span class="n">laplace_guide41</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="code-4-27">
<h1>Code 4.27<a class="headerlink" href="#code-4-27" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">p_summary41</span> <span class="o">=</span> <span class="n">summary</span><span class="p">(</span><span class="n">pred41</span><span class="o">.</span><span class="n">get_samples</span><span class="p">(),</span> <span class="mf">0.945</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;mu&quot;</span><span class="p">,</span> <span class="s2">&quot;sigma&quot;</span><span class="p">]]</span>
<span class="n">p_summary41</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mu</th>
      <th>sigma</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>mean</th>
      <td>154.5977</td>
      <td>7.7472086</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.41963035</td>
      <td>0.296278</td>
    </tr>
    <tr>
      <th>5.5%</th>
      <td>153.93588</td>
      <td>7.279128</td>
    </tr>
    <tr>
      <th>94.5%</th>
      <td>155.24817</td>
      <td>8.223493</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="code-4-28">
<h1>Code 4.28<a class="headerlink" href="#code-4-28" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;mu&quot;</span><span class="p">:</span> <span class="n">howell2</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="s2">&quot;sigma&quot;</span><span class="p">:</span> <span class="n">howell2</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()}</span>
<span class="n">start</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>{&#39;mu&#39;: 154.5970926136364, &#39;sigma&#39;: 7.742332137351995}
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="code-4-29">
<h1>Code 4.29<a class="headerlink" href="#code-4-29" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">model42</span><span class="p">():</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;mu&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="mf">178.</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)))</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;sigma&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">50.</span><span class="p">)))</span>
    <span class="n">height</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">height</span> 
    

<span class="k">def</span> <span class="nf">guide42</span><span class="p">():</span>
    <span class="n">mu_param</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">param</span><span class="p">(</span>
        <span class="s2">&quot;mu_param&quot;</span><span class="p">,</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">140.</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">sigma_param</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">param</span><span class="p">(</span>
        <span class="s2">&quot;sigma_param&quot;</span><span class="p">,</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">20.</span><span class="p">),</span> <span class="n">constraint</span><span class="o">=</span><span class="n">constraints</span><span class="o">.</span><span class="n">positive</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;mu&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Delta</span><span class="p">(</span><span class="n">mu_param</span><span class="p">)),</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;sigma&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Delta</span><span class="p">(</span><span class="n">sigma_param</span><span class="p">))</span>


<span class="n">conditioned42</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="n">model42</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">tensor</span><span class="p">(</span><span class="n">howell2</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)})</span>

<span class="n">pyro</span><span class="o">.</span><span class="n">clear_param_store</span><span class="p">()</span>
<span class="n">svi</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">SVI</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">conditioned42</span><span class="p">,</span>
    <span class="n">guide</span><span class="o">=</span><span class="n">guide42</span><span class="p">,</span>
    <span class="n">optim</span><span class="o">=</span><span class="n">pyro</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">SGD</span><span class="p">({</span><span class="s2">&quot;lr&quot;</span><span class="p">:</span> <span class="mf">0.001</span><span class="p">,</span> <span class="s2">&quot;momentum&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">}),</span>
    <span class="n">loss</span><span class="o">=</span><span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">Trace_ELBO</span><span class="p">(),</span>
<span class="p">)</span>


<span class="n">num_steps</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">losses</span> <span class="o">=</span> <span class="p">[</span><span class="n">svi</span><span class="o">.</span><span class="n">step</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_steps</span><span class="p">)]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">losses</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;ELBO&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;step&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;loss&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;mu42 = &quot;</span><span class="p">,</span> <span class="n">pyro</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;mu_param&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;sigma42 = &quot;</span><span class="p">,</span> <span class="n">pyro</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;sigma_param&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>


<span class="n">guide42</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">autoguide</span><span class="o">.</span><span class="n">AutoLaplaceApproximation</span><span class="p">(</span><span class="n">conditioned42</span><span class="p">)</span>
<span class="n">pyro</span><span class="o">.</span><span class="n">clear_param_store</span><span class="p">()</span>

<span class="n">svi</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">SVI</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">conditioned42</span><span class="p">,</span>
    <span class="n">guide</span><span class="o">=</span><span class="n">guide42</span><span class="p">,</span>
    <span class="n">optim</span><span class="o">=</span><span class="n">pyro</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">SGD</span><span class="p">({</span><span class="s2">&quot;lr&quot;</span><span class="p">:</span> <span class="mf">0.001</span><span class="p">,</span> <span class="s2">&quot;momentum&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">}),</span>
    <span class="n">loss</span><span class="o">=</span><span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">Trace_ELBO</span><span class="p">(),</span>
<span class="p">)</span>
<span class="c1">#svi.run()</span>
<span class="n">losses</span> <span class="o">=</span> <span class="p">[</span><span class="n">svi</span><span class="o">.</span><span class="n">step</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_steps</span><span class="p">)]</span>

<span class="n">laplace_guide42</span> <span class="o">=</span> <span class="n">guide42</span><span class="o">.</span><span class="n">laplace_approximation</span><span class="p">()</span>
<span class="n">pred42</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">Predictive</span><span class="p">(</span><span class="n">laplace_guide42</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">p_summary42</span> <span class="o">=</span> <span class="n">summary</span><span class="p">(</span><span class="n">pred42</span><span class="o">.</span><span class="n">get_samples</span><span class="p">(),</span> <span class="mf">0.945</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;mu&quot;</span><span class="p">,</span> <span class="s2">&quot;sigma&quot;</span><span class="p">]]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">losses</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;ELBO&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;step&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;loss&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="n">p_summary42</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>mu42 =  177.8636932373047
sigma42 =  24.51750946044922
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mu</th>
      <th>sigma</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>mean</th>
      <td>177.86552</td>
      <td>24.527855</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.098871686</td>
      <td>0.9317</td>
    </tr>
    <tr>
      <th>5.5%</th>
      <td>177.70796</td>
      <td>23.01416</td>
    </tr>
    <tr>
      <th>94.5%</th>
      <td>178.02368</td>
      <td>25.99111</td>
    </tr>
  </tbody>
</table>
</div></div><img alt="../_images/04_Chapter04_61_2.png" src="../_images/04_Chapter04_61_2.png" />
</div>
</div>
</div>
<div class="section" id="code-4-30">
<h1>Code 4.30<a class="headerlink" href="#code-4-30" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">vcov</span><span class="p">(</span><span class="n">pred</span><span class="p">):</span>
  <span class="n">mu</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">get_samples</span><span class="p">()[</span><span class="s2">&quot;mu&quot;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
  <span class="n">sigma</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">get_samples</span><span class="p">()[</span><span class="s2">&quot;sigma&quot;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
  <span class="n">t</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">t_mean</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="n">t</span> <span class="o">=</span> <span class="n">t</span> <span class="o">-</span> <span class="n">t_mean</span> 
  <span class="n">cov</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mm</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">t</span><span class="p">))</span><span class="o">*</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">cov</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">cov</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">cov</span>
<span class="n">vcov</span><span class="p">(</span><span class="n">pred41</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>tensor([[0.0103, 0.0018],
        [0.0018, 0.2181]])
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="code-4-31">
<h1>Code 4.31<a class="headerlink" href="#code-4-31" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">cov2cor</span><span class="p">(</span><span class="n">cov</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">cov</span> <span class="o">/</span> <span class="n">cov</span><span class="o">.</span><span class="n">diag</span><span class="p">()</span><span class="o">.</span><span class="n">ger</span><span class="p">(</span><span class="n">cov</span><span class="o">.</span><span class="n">diag</span><span class="p">())</span><span class="o">.</span><span class="n">sqrt</span><span class="p">()</span>

<span class="n">cov</span> <span class="o">=</span> <span class="n">vcov</span><span class="p">(</span><span class="n">pred41</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cov</span><span class="o">.</span><span class="n">diag</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cov2cor</span><span class="p">(</span><span class="n">cov</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>tensor([0.0101, 0.2333])
tensor([[1.0000, 0.0302],
        [0.0302, 1.0000]])
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="code-4-32">
<h1>Code 4.32<a class="headerlink" href="#code-4-32" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pred41_mu</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">pred41</span><span class="o">.</span><span class="n">get_samples</span><span class="p">()[</span><span class="s2">&quot;mu&quot;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
<span class="n">pred41_sigma</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">pred41</span><span class="o">.</span><span class="n">get_samples</span><span class="p">()[</span><span class="s2">&quot;sigma&quot;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>

<span class="n">post</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">pred41_mu</span><span class="p">,</span> <span class="n">pred41_sigma</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">post</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>tensor([[154.5693,   7.2724],
        [154.4774,   7.9250],
        [154.7430,   7.9293],
        ...,
        [154.5790,   7.0756],
        [154.6590,   7.2606],
        [154.5707,   7.9989]])
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="code-4-33">
<h1>Code 4.33<a class="headerlink" href="#code-4-33" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">p_summary</span> <span class="o">=</span> <span class="n">summary</span><span class="p">(</span><span class="n">pred41</span><span class="o">.</span><span class="n">get_samples</span><span class="p">(),</span> <span class="mf">0.945</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;mu&quot;</span><span class="p">,</span> <span class="s2">&quot;sigma&quot;</span><span class="p">]]</span>
<span class="n">p_summary</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mu</th>
      <th>sigma</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>mean</th>
      <td>154.60869</td>
      <td>7.720367</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.097480394</td>
      <td>0.50125045</td>
    </tr>
    <tr>
      <th>5.5%</th>
      <td>154.45084</td>
      <td>6.9692016</td>
    </tr>
    <tr>
      <th>94.5%</th>
      <td>154.76424</td>
      <td>8.564913</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="code-4-34">
<h1>Code 4.34<a class="headerlink" href="#code-4-34" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">post</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">MultivariateNormal</span><span class="p">(</span><span class="n">tensor</span><span class="p">([</span><span class="n">p_summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;mu&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">p_summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;sigma&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
                               <span class="n">cov</span><span class="o">.</span><span class="n">float</span><span class="p">())</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">10000</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="code-4-35">
<h1>Code 4.35<a class="headerlink" href="#code-4-35" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">model41_logsigma</span><span class="p">():</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;mu&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="mf">178.</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">20.</span><span class="p">)))</span>
    <span class="n">logsigma</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;logsigma&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="mf">2.</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">10.</span><span class="p">)))</span>
    <span class="n">height</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">logsigma</span><span class="o">.</span><span class="n">float</span><span class="p">()</span><span class="o">.</span><span class="n">exp</span><span class="p">()))</span>
    <span class="k">return</span> <span class="n">height</span> 

<span class="n">conditioned41_logsigma</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="n">model41_logsigma</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">tensor</span><span class="p">(</span><span class="n">howell2</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)})</span>

<span class="n">guide41_logsigma</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">autoguide</span><span class="o">.</span><span class="n">AutoLaplaceApproximation</span><span class="p">(</span><span class="n">conditioned41_logsigma</span><span class="p">)</span>
<span class="n">pyro</span><span class="o">.</span><span class="n">clear_param_store</span><span class="p">()</span>

<span class="n">svi</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">SVI</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">conditioned41_logsigma</span><span class="p">,</span>
    <span class="n">guide</span><span class="o">=</span><span class="n">guide41_logsigma</span><span class="p">,</span>
    <span class="n">optim</span><span class="o">=</span><span class="n">pyro</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">SGD</span><span class="p">({</span><span class="s2">&quot;lr&quot;</span><span class="p">:</span> <span class="mf">0.001</span><span class="p">,</span> <span class="s2">&quot;momentum&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">}),</span>
    <span class="n">loss</span><span class="o">=</span><span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">Trace_ELBO</span><span class="p">(),</span>
<span class="p">)</span>
<span class="n">num_steps</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">losses</span> <span class="o">=</span> <span class="p">[</span><span class="n">svi</span><span class="o">.</span><span class="n">step</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_steps</span><span class="p">)]</span>

<span class="n">laplace_guide41_logsigma</span> <span class="o">=</span> <span class="n">guide41_logsigma</span><span class="o">.</span><span class="n">laplace_approximation</span><span class="p">()</span>
<span class="n">pred41_logsigma</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">Predictive</span><span class="p">(</span><span class="n">laplace_guide41_logsigma</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">losses</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;ELBO&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;step&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;loss&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04_Chapter04_73_0.png" src="../_images/04_Chapter04_73_0.png" />
</div>
</div>
</div>
<div class="section" id="code-4-36">
<h1>Code 4.36<a class="headerlink" href="#code-4-36" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">post</span> <span class="o">=</span> <span class="n">pred41_logsigma</span><span class="o">.</span><span class="n">get_samples</span><span class="p">()</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">post</span><span class="p">[</span><span class="s2">&quot;logsigma&quot;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sigma</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">sigma</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>tensor(7.7237, grad_fn=&lt;MeanBackward0&gt;) tensor(0.2832, grad_fn=&lt;StdBackward0&gt;)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="code-4-37">
<h1>Code 4.37<a class="headerlink" href="#code-4-37" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">howell2</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">],</span> <span class="n">howell2</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Weight&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Height&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04_Chapter04_77_0.png" src="../_images/04_Chapter04_77_0.png" />
</div>
</div>
</div>
<div class="section" id="code-4-38">
<h1>Code 4.38<a class="headerlink" href="#code-4-38" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">model43</span><span class="p">(</span><span class="n">weight</span><span class="p">):</span>

  <span class="n">weight</span> <span class="o">=</span> <span class="n">weight</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
  <span class="n">a</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="mf">156.</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">100.</span><span class="p">)))</span>
  <span class="n">b</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">10.</span><span class="p">)))</span>
  <span class="n">sigma</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;sigma&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">50.</span><span class="p">)))</span>
  <span class="n">mu</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">weight</span>

  <span class="n">height</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">height</span> 

<span class="k">def</span> <span class="nf">guide43</span><span class="p">(</span><span class="n">weight</span><span class="p">):</span>
  <span class="n">a_param</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;a_param&quot;</span><span class="p">,</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">140.</span><span class="p">))</span>
  <span class="n">b_param</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;b_param&quot;</span><span class="p">,</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">10.</span><span class="p">))</span>
  <span class="n">sigma_param</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;sigma_param&quot;</span><span class="p">,</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">20.</span><span class="p">),</span> <span class="n">constraint</span><span class="o">=</span><span class="n">constraints</span><span class="o">.</span><span class="n">positive</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">(</span><span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Delta</span><span class="p">(</span><span class="n">a_param</span><span class="p">)),</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Delta</span><span class="p">(</span><span class="n">b_param</span><span class="p">)),</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;sigma&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Delta</span><span class="p">(</span><span class="n">sigma_param</span><span class="p">)))</span>

<span class="n">howell2_height</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">howell2</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
<span class="n">howell2_weight</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">howell2</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>

<span class="n">conditioned43</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="n">model43</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">howell2_height</span><span class="p">})</span>

<span class="n">pyro</span><span class="o">.</span><span class="n">clear_param_store</span><span class="p">()</span>
<span class="n">svi</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">SVI</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">conditioned43</span><span class="p">,</span>
    <span class="n">guide</span><span class="o">=</span><span class="n">guide43</span><span class="p">,</span>
    <span class="n">optim</span><span class="o">=</span><span class="n">pyro</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">({</span><span class="s2">&quot;lr&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">}),</span>
    <span class="n">loss</span><span class="o">=</span><span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">Trace_ELBO</span><span class="p">(),</span>
<span class="p">)</span>
<span class="n">num_steps</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">losses</span> <span class="o">=</span> <span class="p">[</span><span class="n">svi</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">howell2_weight</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_steps</span><span class="p">)]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">losses</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;ELBO&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;step&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;loss&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;a = &quot;</span><span class="p">,</span> <span class="n">pyro</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;a_param&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;b = &quot;</span><span class="p">,</span> <span class="n">pyro</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;b_param&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;sigma = &quot;</span><span class="p">,</span> <span class="n">pyro</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;sigma_param&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>a =  113.8953628540039
b =  0.9046070575714111
sigma =  5.0710039138793945
</pre></div>
</div>
<img alt="../_images/04_Chapter04_79_1.png" src="../_images/04_Chapter04_79_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">guide43</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">autoguide</span><span class="o">.</span><span class="n">AutoLaplaceApproximation</span><span class="p">(</span><span class="n">conditioned43</span><span class="p">)</span>
<span class="n">pyro</span><span class="o">.</span><span class="n">clear_param_store</span><span class="p">()</span>

<span class="n">svi</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">SVI</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">conditioned43</span><span class="p">,</span>
    <span class="n">guide</span><span class="o">=</span><span class="n">guide43</span><span class="p">,</span>
    <span class="n">optim</span><span class="o">=</span><span class="n">pyro</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">({</span><span class="s2">&quot;lr&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">}),</span>
    <span class="n">loss</span><span class="o">=</span><span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">Trace_ELBO</span><span class="p">(),</span>
<span class="p">)</span>
<span class="n">num_steps</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">losses</span> <span class="o">=</span> <span class="p">[</span><span class="n">svi</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">howell2_weight</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_steps</span><span class="p">)]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">losses</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;ELBO&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;step&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;loss&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">laplace_guide43</span> <span class="o">=</span> <span class="n">guide43</span><span class="o">.</span><span class="n">laplace_approximation</span><span class="p">(</span><span class="n">howell2_weight</span><span class="p">)</span>
<span class="n">pred43</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">Predictive</span><span class="p">(</span><span class="n">laplace_guide43</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04_Chapter04_80_0.png" src="../_images/04_Chapter04_80_0.png" />
</div>
</div>
</div>
<div class="section" id="code-4-39">
<h1>Code 4.39<a class="headerlink" href="#code-4-39" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">model43</span><span class="p">(</span><span class="n">weight</span><span class="p">):</span>

  <span class="n">weight</span> <span class="o">=</span> <span class="n">weight</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
  <span class="n">a</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="mf">156.</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">100.</span><span class="p">)))</span>
  <span class="n">b</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">10.</span><span class="p">)))</span>
  <span class="n">sigma</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;sigma&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">50.</span><span class="p">)))</span>

  <span class="n">height</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">weight</span><span class="p">,</span> <span class="n">sigma</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">height</span> 

<span class="k">def</span> <span class="nf">guide43</span><span class="p">(</span><span class="n">weight</span><span class="p">):</span>
  <span class="n">a_param</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;a_param&quot;</span><span class="p">,</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">140.</span><span class="p">))</span>
  <span class="n">b_param</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;b_param&quot;</span><span class="p">,</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">10.</span><span class="p">))</span>
  <span class="n">sigma_param</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;sigma_param&quot;</span><span class="p">,</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">20.</span><span class="p">),</span> <span class="n">constraint</span><span class="o">=</span><span class="n">constraints</span><span class="o">.</span><span class="n">positive</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">(</span><span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Delta</span><span class="p">(</span><span class="n">a_param</span><span class="p">)),</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Delta</span><span class="p">(</span><span class="n">b_param</span><span class="p">)),</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;sigma&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Delta</span><span class="p">(</span><span class="n">sigma_param</span><span class="p">)))</span>

<span class="n">howell2_height</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">howell2</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
<span class="n">howell2_weight</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">howell2</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>

<span class="n">conditioned43</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="n">model43</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">howell2_height</span><span class="p">})</span>

<span class="n">pyro</span><span class="o">.</span><span class="n">clear_param_store</span><span class="p">()</span>
<span class="n">svi</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">SVI</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">conditioned43</span><span class="p">,</span>
    <span class="n">guide</span><span class="o">=</span><span class="n">guide43</span><span class="p">,</span>
    <span class="n">optim</span><span class="o">=</span><span class="n">pyro</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">({</span><span class="s2">&quot;lr&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">}),</span>
    <span class="n">loss</span><span class="o">=</span><span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">Trace_ELBO</span><span class="p">(),</span>
<span class="p">)</span>
<span class="n">num_steps</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">losses</span> <span class="o">=</span> <span class="p">[</span><span class="n">svi</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">howell2_weight</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_steps</span><span class="p">)]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">losses</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;ELBO&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;step&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;loss&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;a = &quot;</span><span class="p">,</span> <span class="n">pyro</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;a_param&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;b = &quot;</span><span class="p">,</span> <span class="n">pyro</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;b_param&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;sigma = &quot;</span><span class="p">,</span> <span class="n">pyro</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;sigma_param&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>a =  113.8953628540039
b =  0.9046070575714111
sigma =  5.0710039138793945
</pre></div>
</div>
<img alt="../_images/04_Chapter04_82_1.png" src="../_images/04_Chapter04_82_1.png" />
</div>
</div>
</div>
<div class="section" id="code-4-40">
<h1>Code 4.40<a class="headerlink" href="#code-4-40" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">model43</span><span class="p">(</span><span class="n">weight</span><span class="p">):</span>

  <span class="n">weight</span> <span class="o">=</span> <span class="n">weight</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
  <span class="n">a</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="mf">178.</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">100.</span><span class="p">)))</span>
  <span class="n">b</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">10.</span><span class="p">)))</span>
  <span class="n">sigma</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;sigma&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">50.</span><span class="p">)))</span>

  <span class="n">height</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">weight</span><span class="p">,</span> <span class="n">sigma</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">height</span> 

<span class="k">def</span> <span class="nf">guide43</span><span class="p">(</span><span class="n">weight</span><span class="p">):</span>
  <span class="n">a_param</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;a_param&quot;</span><span class="p">,</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">140.</span><span class="p">))</span>
  <span class="n">b_param</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;b_param&quot;</span><span class="p">,</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">10.</span><span class="p">))</span>
  <span class="n">sigma_param</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;sigma_param&quot;</span><span class="p">,</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">20.</span><span class="p">),</span> <span class="n">constraint</span><span class="o">=</span><span class="n">constraints</span><span class="o">.</span><span class="n">positive</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">(</span><span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Delta</span><span class="p">(</span><span class="n">a_param</span><span class="p">)),</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Delta</span><span class="p">(</span><span class="n">b_param</span><span class="p">)),</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;sigma&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Delta</span><span class="p">(</span><span class="n">sigma_param</span><span class="p">)))</span>

<span class="n">howell2_height</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">howell2</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
<span class="n">howell2_weight</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">howell2</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>

<span class="n">conditioned43</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="n">model43</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">howell2_height</span><span class="p">})</span>
<span class="n">pyro</span><span class="o">.</span><span class="n">clear_param_store</span><span class="p">()</span>
<span class="n">svi</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">SVI</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">conditioned43</span><span class="p">,</span>
    <span class="n">guide</span><span class="o">=</span><span class="n">guide43</span><span class="p">,</span>
    <span class="n">optim</span><span class="o">=</span><span class="n">pyro</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">({</span><span class="s2">&quot;lr&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">}),</span>
    <span class="n">loss</span><span class="o">=</span><span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">Trace_ELBO</span><span class="p">(),</span>
<span class="p">)</span>


<span class="n">num_steps</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">losses</span> <span class="o">=</span> <span class="p">[</span><span class="n">svi</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">howell2_weight</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_steps</span><span class="p">)]</span>
<span class="n">coef_m43_a</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;a_param&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
<span class="n">coef_m43_b</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;b_param&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
<span class="n">coef_m43_sigma</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;sigma_param&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>



<span class="n">guide43</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">autoguide</span><span class="o">.</span><span class="n">AutoLaplaceApproximation</span><span class="p">(</span><span class="n">conditioned43</span><span class="p">)</span>
<span class="n">pyro</span><span class="o">.</span><span class="n">clear_param_store</span><span class="p">()</span>

<span class="n">svi</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">SVI</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">conditioned43</span><span class="p">,</span>
    <span class="n">guide</span><span class="o">=</span><span class="n">guide43</span><span class="p">,</span>
    <span class="n">optim</span><span class="o">=</span><span class="n">pyro</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">({</span><span class="s2">&quot;lr&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">}),</span>
    <span class="n">loss</span><span class="o">=</span><span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">Trace_ELBO</span><span class="p">(),</span>
<span class="p">)</span>
<span class="n">num_steps</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">losses</span> <span class="o">=</span> <span class="p">[</span><span class="n">svi</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">howell2_weight</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_steps</span><span class="p">)]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">losses</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;ELBO&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;step&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;loss&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">laplace_guide43</span> <span class="o">=</span> <span class="n">guide43</span><span class="o">.</span><span class="n">laplace_approximation</span><span class="p">(</span><span class="n">howell2_weight</span><span class="p">)</span>
<span class="n">pred43</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">Predictive</span><span class="p">(</span><span class="n">laplace_guide43</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">summary</span><span class="p">(</span><span class="n">pred43</span><span class="o">.</span><span class="n">get_samples</span><span class="p">())</span><span class="c1">#[[&quot;mu&quot;, &quot;sigma&quot;]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>_AutoMultivariateNormal_latent</th>
      <th>a</th>
      <th>b</th>
      <th>sigma</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>mean</th>
      <td>[113.88146, 0.90482646, -2.1798604]</td>
      <td>113.881454</td>
      <td>0.90482664</td>
      <td>5.082139</td>
    </tr>
    <tr>
      <th>std</th>
      <td>[1.8664569, 0.041342642, 0.043607153]</td>
      <td>1.8664569</td>
      <td>0.041342642</td>
      <td>0.19904946</td>
    </tr>
    <tr>
      <th>5.0%</th>
      <td>[110.85748, 0.8348444, -2.2518702]</td>
      <td>110.85748</td>
      <td>0.8348444</td>
      <td>4.7594132</td>
    </tr>
    <tr>
      <th>95.0%</th>
      <td>[116.87693, 0.97173655, -2.1083288]</td>
      <td>116.87693</td>
      <td>0.97173655</td>
      <td>5.414497</td>
    </tr>
  </tbody>
</table>
</div></div><img alt="../_images/04_Chapter04_84_1.png" src="../_images/04_Chapter04_84_1.png" />
</div>
</div>
</div>
<div class="section" id="code-4-41">
<h1>Code 4.41<a class="headerlink" href="#code-4-41" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">prob</span><span class="o">=</span><span class="mf">0.95</span><span class="p">):</span>
    <span class="n">site_stats</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">samples</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">site_stats</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
            <span class="s2">&quot;std&quot;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
            <span class="s2">&quot;</span><span class="si">{:.1f}</span><span class="s2">%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">prob</span><span class="p">)):</span> <span class="n">v</span><span class="o">.</span><span class="n">kthvalue</span><span class="p">(</span>
                <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">prob</span><span class="p">)),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
            <span class="s2">&quot;</span><span class="si">{:.1f}</span><span class="s2">%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">prob</span><span class="p">):</span> <span class="n">v</span><span class="o">.</span><span class="n">kthvalue</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">prob</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span>
                <span class="mi">0</span>
            <span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
        <span class="p">}</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">site_stats</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">vcov_gen</span><span class="p">(</span><span class="n">samples</span><span class="p">):</span>
  <span class="n">cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">samples</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
  <span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="n">samples</span><span class="p">[</span><span class="n">cols</span><span class="p">[</span><span class="mi">1</span><span class="p">]]]</span>
  <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">[</span><span class="mi">2</span><span class="p">:]:</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">samples</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
    <span class="n">t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
  <span class="n">t</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">t_mean</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="n">t</span> <span class="o">=</span> <span class="n">t</span> <span class="o">-</span> <span class="n">t_mean</span> 
  <span class="n">cov</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mm</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">t</span><span class="p">))</span><span class="o">*</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">cov</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">cov</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">cov</span>

<span class="n">cov</span> <span class="o">=</span> <span class="n">vcov_gen</span><span class="p">(</span><span class="n">pred43</span><span class="o">.</span><span class="n">get_samples</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cov2cor</span><span class="p">(</span><span class="n">cov</span><span class="p">))</span>
<span class="n">summary</span><span class="p">(</span><span class="n">pred43</span><span class="o">.</span><span class="n">get_samples</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>tensor([[ 1.0000, -0.9910,  0.0055],
        [-0.9910,  1.0000, -0.0050],
        [ 0.0055, -0.0050,  1.0000]])
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>_AutoMultivariateNormal_latent</th>
      <th>a</th>
      <th>b</th>
      <th>sigma</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>mean</th>
      <td>[113.92777, 0.90385574, -2.1774273]</td>
      <td>113.92784</td>
      <td>0.9038558</td>
      <td>5.0932407</td>
    </tr>
    <tr>
      <th>std</th>
      <td>[1.9352609, 0.042408593, 0.04351259]</td>
      <td>1.9352609</td>
      <td>0.042408593</td>
      <td>0.19932434</td>
    </tr>
    <tr>
      <th>5.0%</th>
      <td>[110.83859, 0.82876086, -2.2503645]</td>
      <td>110.83859</td>
      <td>0.82876086</td>
      <td>4.7659016</td>
    </tr>
    <tr>
      <th>95.0%</th>
      <td>[117.291115, 0.9713822, -2.1043088]</td>
      <td>117.291115</td>
      <td>0.9713822</td>
      <td>5.4339366</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="code-4-42">
<h1>Code 4.42<a class="headerlink" href="#code-4-42" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">howell2</span><span class="p">[</span><span class="s1">&#39;weight_centered&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">howell2</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">howell2</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="code-4-43">
<h1>Code 4.43<a class="headerlink" href="#code-4-43" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">model44</span><span class="p">(</span><span class="n">weight_centered</span><span class="p">):</span>

  <span class="n">weight_centered</span> <span class="o">=</span> <span class="n">weight_centered</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
  <span class="n">a</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="mf">178.</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">100.</span><span class="p">)))</span>
  <span class="n">b</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">10.</span><span class="p">)))</span>
  <span class="n">sigma</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;sigma&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">50.</span><span class="p">)))</span>

  <span class="n">height</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">weight_centered</span><span class="p">,</span> <span class="n">sigma</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">height</span> 

<span class="k">def</span> <span class="nf">guide44</span><span class="p">(</span><span class="n">weight_centered</span><span class="p">):</span>
  <span class="n">a_param</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;a_param&quot;</span><span class="p">,</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">140.</span><span class="p">))</span>
  <span class="n">b_param</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;b_param&quot;</span><span class="p">,</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">10.</span><span class="p">))</span>
  <span class="n">sigma_param</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;sigma_param&quot;</span><span class="p">,</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">20.</span><span class="p">),</span> <span class="n">constraint</span><span class="o">=</span><span class="n">constraints</span><span class="o">.</span><span class="n">positive</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">(</span><span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Delta</span><span class="p">(</span><span class="n">a_param</span><span class="p">)),</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Delta</span><span class="p">(</span><span class="n">b_param</span><span class="p">)),</span> 
          <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;sigma&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Delta</span><span class="p">(</span><span class="n">sigma_param</span><span class="p">)))</span>

<span class="n">howell2_height</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">howell2</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
<span class="n">howell2_weight_centered</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">howell2</span><span class="p">[</span><span class="s1">&#39;weight_centered&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>

<span class="n">conditioned44</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="n">model44</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">howell2_height</span><span class="p">})</span>
<span class="n">pyro</span><span class="o">.</span><span class="n">clear_param_store</span><span class="p">()</span>
<span class="n">svi</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">SVI</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">conditioned44</span><span class="p">,</span>
    <span class="n">guide</span><span class="o">=</span><span class="n">guide44</span><span class="p">,</span>
    <span class="n">optim</span><span class="o">=</span><span class="n">pyro</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">({</span><span class="s2">&quot;lr&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">}),</span>
    <span class="n">loss</span><span class="o">=</span><span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">Trace_ELBO</span><span class="p">(),</span>
<span class="p">)</span>


<span class="n">num_steps</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">losses</span> <span class="o">=</span> <span class="p">[</span><span class="n">svi</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">howell2_weight_centered</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_steps</span><span class="p">)]</span>
<span class="n">coef_m44_a</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;a_param&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
<span class="n">coef_m44_b</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;b_param&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
<span class="n">coef_m44_sigma</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;sigma_param&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>


<span class="n">guide44</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">autoguide</span><span class="o">.</span><span class="n">AutoLaplaceApproximation</span><span class="p">(</span><span class="n">conditioned44</span><span class="p">)</span>
<span class="n">pyro</span><span class="o">.</span><span class="n">clear_param_store</span><span class="p">()</span>

<span class="n">svi</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">SVI</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">conditioned44</span><span class="p">,</span>
    <span class="n">guide</span><span class="o">=</span><span class="n">guide44</span><span class="p">,</span>
    <span class="n">optim</span><span class="o">=</span><span class="n">pyro</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">({</span><span class="s2">&quot;lr&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">}),</span>
    <span class="n">loss</span><span class="o">=</span><span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">Trace_ELBO</span><span class="p">(),</span>
<span class="p">)</span>
<span class="n">num_steps</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">losses</span> <span class="o">=</span> <span class="p">[</span><span class="n">svi</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">howell2_weight_centered</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_steps</span><span class="p">)]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">losses</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;ELBO&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;step&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;loss&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">laplace_guide44</span> <span class="o">=</span> <span class="n">guide44</span><span class="o">.</span><span class="n">laplace_approximation</span><span class="p">(</span><span class="n">howell2_weight_centered</span><span class="p">)</span>
<span class="n">pred44</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">Predictive</span><span class="p">(</span><span class="n">laplace_guide44</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04_Chapter04_90_0.png" src="../_images/04_Chapter04_90_0.png" />
</div>
</div>
</div>
<div class="section" id="code-4-44">
<h1>Code 4.44<a class="headerlink" href="#code-4-44" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cov</span> <span class="o">=</span> <span class="n">vcov_gen</span><span class="p">(</span><span class="n">pred44</span><span class="o">.</span><span class="n">get_samples</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cov2cor</span><span class="p">(</span><span class="n">cov</span><span class="p">))</span>
<span class="n">summary</span><span class="p">(</span><span class="n">pred44</span><span class="o">.</span><span class="n">get_samples</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>tensor([[ 1.0000, -0.0264,  0.0438],
        [-0.0264,  1.0000, -0.0251],
        [ 0.0438, -0.0251,  1.0000]])
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>_AutoMultivariateNormal_latent</th>
      <th>a</th>
      <th>b</th>
      <th>sigma</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>mean</th>
      <td>[154.60448, 0.9050131, -2.1805956]</td>
      <td>154.60442</td>
      <td>0.9050131</td>
      <td>5.0782866</td>
    </tr>
    <tr>
      <th>std</th>
      <td>[0.27103165, 0.042811833, 0.040348187]</td>
      <td>0.27103165</td>
      <td>0.042811833</td>
      <td>0.18406394</td>
    </tr>
    <tr>
      <th>5.0%</th>
      <td>[154.15924, 0.83221877, -2.246851]</td>
      <td>154.15924</td>
      <td>0.83221877</td>
      <td>4.7810717</td>
    </tr>
    <tr>
      <th>95.0%</th>
      <td>[155.04999, 0.9744703, -2.1168478]</td>
      <td>155.04999</td>
      <td>0.9744703</td>
      <td>5.3735027</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="code-4-45">
<h1>Code 4.45<a class="headerlink" href="#code-4-45" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">howell2</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">howell2</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">howell2</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span> <span class="n">howell2</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">*</span><span class="n">coef_m43_b</span> <span class="o">+</span> <span class="n">coef_m43_a</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Weight&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Height&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04_Chapter04_94_0.png" src="../_images/04_Chapter04_94_0.png" />
</div>
</div>
</div>
<div class="section" id="code-4-46">
<h1>Code 4.46<a class="headerlink" href="#code-4-46" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">post</span> <span class="o">=</span> <span class="n">pred43</span><span class="o">.</span><span class="n">get_samples</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="code-4-47">
<h1>Code 4.47<a class="headerlink" href="#code-4-47" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">post</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>{&#39;_AutoMultivariateNormal_latent&#39;: tensor([[114.1417,   0.8448,  -2.2523],
         [113.7764,   0.9718,  -2.1141],
         [113.6371,   0.8523,  -2.2056],
         ...,
         [113.8768,   0.9067,  -2.1677],
         [113.6774,   0.9603,  -2.1650],
         [114.7714,   0.9336,  -2.0775]], grad_fn=&lt;ViewBackward&gt;),
 &#39;a&#39;: tensor([114.1417, 113.7764, 113.6371, 113.4627, 113.8561, 113.8759, 114.0705,
         113.8973, 113.9260, 113.9124, 114.4091, 113.3537, 113.8284, 113.3768,
         114.0937, 113.7870, 113.9813, 113.9841, 114.2106, 113.7158, 113.1776,
         113.3713, 113.9151, 113.5330, 113.9986, 113.8083, 113.7560, 113.8010,
         113.3781, 114.0362, 113.8035, 114.1163, 113.8056, 114.1140, 114.1226,
         114.1142, 113.9531, 113.7217, 113.4743, 113.6875, 114.4002, 114.0517,
         113.6275, 114.0897, 114.0033, 113.9235, 114.3421, 113.8833, 113.8892,
         113.6062, 113.3754, 113.3741, 113.6971, 113.7879, 113.9177, 114.1148,
         113.9093, 113.5019, 114.0530, 113.9487, 114.3803, 113.4802, 113.7437,
         113.7455, 114.1652, 113.8872, 114.1262, 114.0452, 114.1065, 113.8765,
         113.7793, 113.4961, 114.2777, 114.4152, 113.5764, 114.1571, 114.0997,
         114.1067, 113.9539, 114.2900, 113.8047, 113.6792, 114.1344, 113.9586,
         113.9062, 113.8774, 113.8130, 114.0963, 113.8351, 113.7079, 113.7732,
         113.7894, 113.6113, 114.3435, 114.1737, 113.7855, 114.4375, 113.9276,
         113.9371, 113.9980, 114.0562, 113.5939, 114.1138, 113.7063, 114.1950,
         114.1828, 113.7671, 113.9768, 113.3312, 113.5186, 113.8295, 113.6373,
         113.3543, 114.3070, 113.9925, 113.8952, 114.1238, 113.8803, 113.9695,
         113.9478, 113.5161, 113.6776, 114.1852, 113.7533, 114.4015, 114.1445,
         113.9956, 113.8482, 113.8256, 113.8720, 113.6781, 113.9253, 113.6876,
         113.9982, 113.8752, 113.6003, 114.1372, 113.6020, 114.0690, 113.8031,
         113.6892, 113.9254, 113.5097, 113.7665, 113.7068, 114.1408, 114.1404,
         113.9725, 114.2313, 113.7547, 114.3614, 113.9119, 113.3683, 114.0575,
         113.7285, 113.2966, 113.8155, 113.6569, 114.0118, 113.8976, 114.0417,
         113.8914, 113.8049, 113.9397, 113.9187, 114.1306, 114.0017, 114.0902,
         113.8021, 113.5953, 114.5053, 113.5481, 113.4568, 114.1994, 113.9623,
         113.8676, 114.2323, 113.9635, 113.7098, 113.6012, 114.1189, 114.2066,
         114.2791, 113.9013, 113.6215, 113.7998, 113.8931, 113.7062, 114.0907,
         113.9726, 113.8960, 113.6014, 113.4793, 113.4478, 113.8266, 114.0975,
         114.0848, 113.8476, 114.0119, 113.8325, 113.5765, 114.0137, 113.7929,
         113.0767, 113.8227, 114.1801, 113.7489, 114.3444, 113.5047, 114.4732,
         113.9210, 113.9970, 113.5001, 113.7859, 113.8792, 113.9185, 113.6631,
         114.4019, 113.8562, 113.7067, 113.6019, 114.3067, 113.8222, 113.9677,
         113.7713, 113.8626, 114.1758, 113.2800, 113.4408, 113.4278, 114.0033,
         113.9487, 113.1923, 113.4497, 113.6026, 113.8048, 114.2393, 113.8681,
         114.0873, 113.6503, 114.0246, 113.8234, 113.8669, 113.7844, 114.1232,
         113.7751, 114.1016, 113.7248, 113.7949, 114.2364, 113.3339, 114.2076,
         113.4715, 113.8162, 114.1599, 114.0679, 113.8695, 113.6712, 113.8187,
         113.8109, 114.1578, 114.3551, 113.5760, 114.0450, 114.3940, 113.6756,
         113.9107, 113.8471, 113.5340, 113.4658, 114.3192, 114.2195, 113.4651,
         113.9424, 113.6814, 113.6233, 113.6956, 114.0829, 114.1273, 114.1424,
         113.6838, 113.9732, 113.7667, 113.3938, 114.2007, 113.8861, 114.0606,
         113.8623, 114.3865, 113.8824, 113.6307, 114.5452, 114.0258, 114.2067,
         114.2732, 113.6772, 114.6852, 114.2606, 113.7658, 114.1794, 113.4951,
         113.6335, 114.3275, 113.5692, 114.0297, 114.2254, 114.2040, 113.7460,
         114.4001, 114.2459, 114.0363, 113.8080, 114.0355, 114.1404, 113.8114,
         113.8208, 114.0583, 114.2078, 113.6674, 113.9175, 113.8268, 113.7366,
         113.7981, 113.7907, 114.0953, 113.4497, 113.9161, 113.4536, 114.0124,
         112.9122, 113.9945, 113.7071, 114.3563, 114.2494, 113.9918, 113.2575,
         113.9893, 113.2155, 114.3286, 114.1107, 113.8212, 113.9795, 113.6838,
         114.0219, 114.0067, 114.0807, 114.1284, 113.9948, 113.5292, 113.6685,
         114.3296, 113.8521, 113.5913, 113.5048, 113.8160, 113.9081, 113.7147,
         113.8400, 113.8465, 113.7264, 113.7357, 114.0329, 113.9318, 114.1814,
         113.7249, 114.0660, 114.0978, 114.3367, 113.9849, 113.7081, 113.5814,
         114.0924, 113.9835, 114.1222, 114.2471, 113.7957, 114.4468, 114.0839,
         113.6098, 114.0210, 113.5809, 113.5594, 114.3008, 114.1832, 113.6687,
         113.8183, 113.7216, 114.2073, 114.2925, 114.2665, 114.5491, 113.3654,
         114.1179, 113.8190, 113.4864, 114.0817, 114.0910, 113.7997, 114.0893,
         113.8035, 113.9605, 113.8648, 114.3395, 113.7062, 113.8365, 113.6864,
         114.3563, 113.8897, 114.5099, 113.7149, 113.9603, 113.6505, 114.0613,
         113.8411, 113.8299, 113.8564, 114.1855, 113.9157, 113.5610, 113.7495,
         113.9283, 114.1832, 114.1410, 113.6625, 114.5104, 114.1993, 113.6780,
         114.1645, 113.8237, 113.5824, 113.2849, 113.6871, 113.6167, 114.0159,
         114.3516, 113.9297, 113.4961, 114.3015, 113.6045, 113.7199, 113.8652,
         114.4520, 113.6980, 113.9194, 113.4335, 113.7707, 113.8647, 113.3227,
         114.1560, 114.0091, 113.9593, 113.9603, 113.5024, 113.8951, 113.7056,
         113.8909, 113.7770, 113.6096, 114.4866, 114.1523, 114.0022, 114.6445,
         114.0187, 113.6393, 114.4103, 114.1399, 113.8873, 113.9838, 113.8650,
         113.7218, 114.0633, 114.1683, 114.1168, 113.8710, 113.9706, 113.5930,
         113.4159, 113.5967, 114.0422, 113.9190, 113.8413, 114.0576, 113.8347,
         114.1622, 113.7986, 113.2989, 113.4676, 113.8640, 113.7330, 113.9537,
         113.5172, 113.6507, 113.8619, 114.0411, 114.0531, 114.3865, 114.1217,
         113.5871, 113.5336, 113.7287, 114.2986, 113.5282, 113.8503, 114.3467,
         113.8491, 113.6231, 113.6539, 114.1658, 113.5967, 114.8059, 114.0060,
         114.0882, 113.8383, 113.9121, 113.6785, 113.8624, 113.3907, 113.7628,
         113.7250, 113.5842, 114.3960, 114.2859, 114.0061, 113.6967, 114.2013,
         113.5314, 113.9584, 114.0711, 113.9152, 113.9966, 113.7246, 113.9399,
         114.2581, 113.7662, 114.2081, 113.7629, 113.8866, 113.7490, 113.9456,
         114.2107, 114.1304, 113.6209, 113.5045, 113.2315, 113.8750, 113.8818,
         113.9094, 113.9640, 114.0349, 114.1739, 113.7925, 113.7619, 113.8340,
         114.3956, 114.0506, 114.1307, 113.5113, 113.7225, 113.7290, 114.0862,
         113.9369, 113.8394, 113.8270, 114.0889, 113.4493, 113.9327, 113.9320,
         113.9173, 113.8737, 114.1036, 113.8363, 114.1245, 114.0768, 113.9942,
         113.9147, 113.8774, 113.7111, 113.7669, 114.1430, 113.7826, 114.1063,
         113.3817, 113.6954, 113.6061, 113.9238, 113.6383, 114.1854, 113.9784,
         113.9930, 113.8169, 113.8769, 113.7441, 114.0562, 113.7038, 113.9543,
         113.6820, 114.0659, 113.7625, 113.5923, 114.1256, 113.5020, 113.8623,
         114.2225, 113.5160, 114.1006, 113.8697, 113.8340, 114.1494, 113.5748,
         114.2125, 114.0811, 113.7305, 114.1824, 114.6015, 113.9727, 113.7051,
         113.9303, 113.6242, 113.9270, 114.0176, 114.0435, 114.0903, 113.6420,
         114.1997, 113.7566, 113.9008, 113.6110, 114.1855, 113.7725, 113.5557,
         113.9786, 113.7812, 114.3580, 113.5819, 113.8457, 113.6817, 113.8592,
         113.8272, 113.7906, 113.8658, 113.9402, 114.4853, 113.5280, 113.4790,
         113.6502, 113.8895, 113.6773, 113.5469, 114.0015, 113.9665, 113.8011,
         113.9304, 113.9442, 113.6913, 113.6871, 113.7062, 113.7651, 114.1417,
         113.6929, 113.7064, 114.2505, 113.8551, 113.8909, 113.8526, 114.0498,
         113.9248, 113.8970, 113.5908, 113.9230, 113.8590, 113.9503, 114.0213,
         113.5218, 113.4227, 113.5838, 113.3815, 114.1171, 113.8404, 113.6154,
         113.5210, 113.7670, 113.8954, 114.1556, 113.5502, 114.1105, 113.6574,
         113.9593, 113.7357, 113.9896, 114.0703, 114.1258, 113.9340, 113.6385,
         114.0972, 113.6884, 113.9409, 113.5576, 113.6888, 113.8189, 114.3170,
         114.2743, 113.8592, 113.3342, 114.0208, 113.6801, 114.0312, 113.9708,
         114.1867, 113.8090, 114.3602, 113.8954, 113.7177, 113.5517, 114.0140,
         113.8219, 113.8765, 114.1272, 113.8511, 113.6322, 113.9033, 113.3236,
         113.5540, 114.1974, 113.5964, 113.8819, 113.4923, 113.8444, 113.3163,
         113.9758, 113.8361, 113.6779, 114.0447, 113.8295, 113.9528, 113.7066,
         113.8084, 113.3981, 114.6284, 113.1994, 113.5782, 113.8254, 114.0390,
         114.0047, 113.7010, 113.6622, 114.2348, 114.1125, 113.9773, 113.3981,
         113.9367, 113.5949, 113.6703, 113.7647, 113.9439, 113.4887, 113.8532,
         113.6873, 113.9786, 113.9495, 113.9410, 114.1794, 113.8234, 114.0594,
         114.0431, 113.9465, 113.7012, 113.5664, 113.8798, 113.6145, 114.2149,
         113.4858, 113.6734, 113.6163, 113.7515, 113.6690, 113.7750, 113.8874,
         114.1166, 113.6464, 114.1124, 113.9763, 113.9522, 114.0696, 114.1666,
         113.6702, 114.3840, 113.9834, 114.5500, 113.6230, 113.8324, 114.1450,
         114.3349, 113.6757, 114.6176, 113.8358, 113.7015, 113.8663, 113.5291,
         113.6541, 114.4342, 113.9148, 113.6422, 114.0116, 113.7678, 113.9059,
         113.8790, 114.2122, 113.6928, 114.0862, 113.7229, 113.4854, 114.0895,
         113.6483, 113.9918, 114.0441, 114.1930, 114.1505, 113.8489, 114.2559,
         113.6397, 113.8788, 114.1064, 113.5647, 114.0632, 113.9920, 114.1082,
         113.7949, 113.8636, 113.8236, 113.9990, 114.0561, 113.9742, 114.0597,
         113.4963, 114.2429, 114.1964, 113.2698, 113.9766, 113.8873, 113.6071,
         113.8909, 114.5457, 114.0102, 113.8350, 114.1130, 114.1422, 113.5983,
         113.9805, 114.2713, 114.0640, 114.2757, 113.4294, 113.6874, 113.9385,
         114.0429, 114.0077, 113.8172, 113.6051, 113.8900, 113.7944, 114.0300,
         114.0569, 114.0112, 114.0074, 113.3732, 114.4277, 113.7500, 114.1626,
         113.8418, 113.5872, 113.6166, 114.1026, 113.8262, 114.2040, 113.7826,
         113.8821, 113.6900, 113.9910, 113.7803, 114.4057, 113.8601, 114.2856,
         113.8836, 114.0947, 114.1656, 113.9457, 114.1515, 113.8115, 113.9565,
         113.9775, 113.8337, 113.8435, 113.7882, 114.2184, 113.9534, 113.8717,
         113.8163, 114.2887, 113.4147, 113.5499, 113.6664, 114.2812, 114.0163,
         113.5803, 113.7598, 113.9192, 114.0977, 113.6495, 113.7747, 113.4110,
         114.2944, 113.8271, 114.0034, 113.7410, 114.0338, 113.6485, 114.4213,
         114.2974, 114.4371, 114.1584, 114.2524, 113.5598, 113.4008, 113.7719,
         114.0327, 113.6334, 113.8383, 113.7175, 114.1423, 114.1290, 113.8165,
         114.3865, 114.1331, 113.8750, 114.2545, 113.9312, 114.0227, 113.9233,
         114.0360, 113.3592, 113.5087, 113.9964, 114.0227, 113.5885, 114.1782,
         113.4651, 113.2740, 113.8359, 113.8412, 113.8355, 113.7734, 113.4158,
         114.2703, 113.8619, 113.9060, 114.0242, 113.8860, 113.7202, 113.7296,
         113.6968, 113.8431, 113.8854, 114.0999, 113.8156, 114.2253, 114.5265,
         114.1875, 113.9074, 113.9884, 114.0270, 113.7985, 114.1926, 113.8992,
         113.7545, 114.0033, 113.5940, 114.2303, 113.7741, 113.1065, 113.8670,
         114.0054, 114.0740, 114.1823, 114.2488, 113.5032, 113.8268, 114.2001,
         113.7327, 114.1486, 114.2320, 114.0504, 113.5736, 114.0906, 113.9052,
         113.9351, 114.0415, 113.6540, 113.8768, 113.6774, 114.7714],
        grad_fn=&lt;ViewBackward&gt;),
 &#39;b&#39;: tensor([0.8448, 0.9718, 0.8523, 0.8617, 0.8468, 0.9438, 0.8322, 0.8759, 0.8228,
         0.9856, 0.9039, 0.8285, 0.9393, 0.9064, 0.9349, 0.8733, 0.8945, 0.8953,
         0.9682, 0.8307, 0.9432, 0.9556, 0.9075, 0.9213, 0.8894, 1.0070, 0.8744,
         0.8625, 0.9307, 0.9257, 0.8826, 0.9559, 0.8585, 0.9061, 0.8789, 0.9303,
         0.9058, 0.9598, 0.9299, 0.8790, 0.9343, 0.8936, 0.8477, 0.9050, 0.8920,
         0.8980, 0.8706, 0.9361, 0.8569, 0.8939, 0.9533, 0.7938, 0.9520, 0.9639,
         0.8613, 0.8512, 0.8948, 0.9364, 0.8656, 0.9102, 0.9026, 0.8981, 0.8518,
         0.8843, 0.8682, 0.9122, 0.9096, 0.9166, 0.8447, 0.9298, 0.8889, 0.9264,
         0.9118, 0.8675, 0.9705, 0.9571, 0.9135, 0.8306, 0.8864, 0.9327, 0.9227,
         0.9537, 0.8209, 0.8758, 0.9350, 0.9152, 0.8417, 0.9603, 0.9184, 0.7958,
         0.9095, 0.9195, 0.8894, 0.8430, 0.9122, 0.8784, 0.9417, 0.9020, 0.9189,
         0.8889, 0.9458, 0.9000, 0.8757, 0.9687, 0.9181, 0.8436, 0.8640, 0.9230,
         0.9857, 0.8532, 0.9483, 0.8647, 1.0065, 0.9110, 0.9286, 0.8415, 0.9079,
         0.9123, 0.9447, 0.9310, 0.8219, 0.9316, 0.7978, 0.9379, 0.8891, 0.9408,
         0.9275, 0.9267, 0.9284, 0.9995, 0.8868, 0.9109, 0.8897, 0.9048, 0.8931,
         0.8309, 0.8853, 0.8731, 0.8545, 0.9576, 0.9231, 0.8377, 0.8783, 0.8782,
         0.8869, 0.8857, 0.9160, 0.9314, 0.8600, 0.9593, 0.9450, 0.9087, 0.9035,
         0.8837, 0.8926, 0.8570, 0.8431, 0.8677, 0.8657, 0.8648, 0.9185, 0.8412,
         0.8516, 0.8422, 0.8714, 1.0199, 0.9122, 0.9593, 0.9413, 0.8664, 0.8603,
         0.9705, 0.9414, 0.8852, 0.8950, 0.9145, 0.9278, 0.8066, 0.9828, 0.9411,
         0.9143, 0.9311, 0.9199, 1.0181, 0.8857, 0.8961, 0.9045, 0.9726, 0.9354,
         0.9013, 0.8705, 0.9092, 0.8842, 0.8927, 0.9156, 0.9168, 0.8709, 0.9713,
         0.9271, 0.9257, 0.8778, 0.9611, 0.9411, 0.9501, 0.9279, 0.8554, 0.8266,
         0.9387, 0.8979, 0.9289, 0.8833, 0.9685, 0.8883, 0.9265, 0.8768, 0.8845,
         0.8544, 0.9056, 0.9432, 0.8987, 0.8539, 0.8463, 0.9211, 0.9041, 0.9567,
         0.8884, 0.8802, 0.9153, 0.9116, 0.9150, 0.8694, 0.8980, 0.9101, 0.9107,
         0.9056, 0.9066, 0.8994, 0.8439, 0.9375, 0.9846, 0.9132, 0.9006, 0.9549,
         0.9480, 0.8699, 0.9137, 0.9252, 0.9538, 0.8719, 0.9491, 0.8609, 0.8594,
         0.9110, 0.9559, 0.8870, 0.9025, 0.8690, 0.9841, 0.8819, 0.9047, 0.8477,
         0.8697, 0.9374, 0.9064, 0.8281, 0.8906, 0.8848, 0.9489, 0.9356, 0.8634,
         0.9222, 0.8956, 0.8774, 0.8312, 0.9272, 0.9506, 0.9417, 0.8795, 0.9402,
         0.9130, 0.8470, 0.9472, 0.8877, 0.9366, 0.9178, 0.8994, 0.9237, 0.9061,
         0.8791, 0.9387, 0.9547, 0.8837, 0.8542, 0.8701, 0.8400, 0.9327, 0.9318,
         0.9393, 0.8974, 0.8914, 0.9430, 0.8871, 0.9635, 0.8434, 0.9735, 0.9678,
         0.9064, 0.9281, 0.8964, 0.9195, 0.9453, 0.9662, 0.8798, 0.8552, 0.8381,
         0.9235, 0.9376, 0.9423, 0.8800, 0.9263, 0.8892, 0.8511, 0.9037, 0.8508,
         0.9435, 0.9427, 0.8754, 0.9167, 0.8520, 0.8848, 0.8752, 0.9363, 0.9080,
         0.8671, 0.8746, 0.9626, 0.9602, 0.8991, 0.9406, 0.8696, 0.9293, 0.9515,
         0.9295, 0.8779, 0.9451, 0.9018, 0.8738, 0.9340, 0.9517, 0.9226, 0.8848,
         0.8975, 0.9009, 0.8775, 0.8701, 0.8696, 0.9467, 0.9151, 0.8674, 0.8788,
         0.9803, 0.9301, 0.8990, 0.8668, 0.8454, 0.8842, 0.9658, 0.9517, 0.8976,
         0.8639, 0.8311, 0.9455, 0.9746, 0.8738, 0.9908, 0.8980, 0.9379, 0.9141,
         0.9628, 0.8985, 0.9415, 0.8751, 0.8189, 0.8211, 0.8176, 0.8803, 0.8964,
         0.8876, 0.8913, 0.8828, 1.0069, 0.9263, 0.8208, 0.9202, 0.9283, 0.9195,
         0.9563, 0.9534, 0.8493, 0.8251, 0.9237, 0.9712, 0.8979, 0.8923, 0.8642,
         0.9293, 0.9070, 0.9216, 0.9462, 0.9713, 0.8988, 0.9115, 0.8618, 0.8625,
         0.8630, 0.8842, 0.8287, 0.8934, 0.9043, 0.9515, 0.8764, 0.9186, 0.9282,
         0.8095, 0.8571, 0.9888, 0.8851, 0.8440, 0.8910, 0.9570, 0.9354, 0.9048,
         0.9158, 0.9561, 0.9441, 0.9359, 0.9315, 1.0067, 0.9149, 0.9701, 0.9636,
         0.8699, 0.8731, 0.9557, 0.9153, 0.9810, 0.8710, 0.9387, 0.8336, 0.9093,
         0.9059, 0.9253, 0.9164, 0.9319, 0.8144, 0.9047, 0.9794, 0.9397, 0.8525,
         0.8977, 0.8923, 0.8673, 0.9235, 0.8462, 0.9352, 0.9413, 0.8636, 0.8426,
         0.8979, 0.9176, 0.9280, 0.8830, 0.9570, 0.9691, 0.9127, 0.9604, 0.9416,
         0.8512, 0.9374, 0.9236, 0.9714, 0.9577, 0.9119, 0.9127, 0.9800, 0.9712,
         0.8511, 0.9810, 0.9012, 0.9060, 0.9961, 0.9432, 0.9984, 0.8869, 0.8017,
         0.9355, 0.8906, 0.8925, 0.8620, 0.8400, 0.9063, 0.9065, 0.9109, 0.8893,
         0.8900, 0.9253, 0.8291, 0.9415, 0.9069, 0.9091, 0.9188, 0.9104, 0.8040,
         0.9084, 0.8716, 0.8902, 0.8388, 0.8922, 0.8393, 0.9520, 0.9553, 0.9461,
         0.8745, 0.9709, 0.9095, 0.8999, 0.8960, 0.9847, 0.9073, 0.9304, 0.8796,
         0.9182, 0.9743, 0.9123, 0.8763, 0.8882, 0.9279, 0.9021, 0.9469, 0.9634,
         0.8899, 0.8703, 0.9285, 0.8963, 0.9231, 0.8345, 0.8833, 0.8336, 0.9032,
         0.9003, 0.8460, 0.8856, 0.9452, 0.8966, 0.8788, 0.8867, 0.9486, 0.8868,
         0.8834, 0.8268, 0.8567, 0.9150, 0.9488, 0.9442, 0.9041, 0.8831, 0.9091,
         0.9872, 0.8608, 0.8807, 0.9136, 0.9100, 0.9797, 0.8332, 0.9358, 0.9034,
         0.8929, 0.9121, 0.8622, 0.9540, 0.8852, 0.9498, 0.8596, 0.9216, 0.9788,
         0.8829, 0.9417, 0.9213, 0.9658, 0.8925, 0.9573, 0.8953, 0.9741, 0.8904,
         0.9868, 0.9017, 0.7927, 0.8248, 0.9599, 0.8391, 0.8800, 0.9118, 0.8424,
         0.8638, 0.9013, 0.8888, 0.8970, 0.8444, 0.9090, 0.9006, 0.8704, 0.9050,
         0.8585, 0.9185, 0.8976, 0.9157, 1.0472, 0.9245, 0.9051, 0.8418, 0.8455,
         0.8706, 0.9643, 0.8443, 0.8478, 0.9320, 0.8946, 0.7997, 0.8869, 0.8892,
         0.8984, 0.9036, 0.8446, 0.8876, 0.9307, 0.8380, 0.9298, 0.8782, 0.9684,
         0.9169, 0.8861, 0.9011, 0.8870, 0.9515, 0.9774, 0.8542, 0.9685, 0.8527,
         0.9330, 0.8816, 0.8725, 0.9149, 0.8898, 0.9610, 0.8657, 0.9163, 0.9034,
         0.8916, 0.9196, 0.9099, 0.9600, 0.9405, 0.8859, 0.8389, 0.8781, 0.8721,
         0.9801, 0.8852, 0.8698, 0.9092, 0.8569, 0.8824, 1.0060, 0.8954, 0.8783,
         0.8908, 0.9624, 0.9310, 0.8678, 0.9491, 0.8240, 0.9372, 0.9268, 0.8858,
         0.8664, 0.8971, 0.9475, 0.9719, 0.9462, 0.9376, 0.8991, 0.9378, 0.9030,
         0.8851, 0.8736, 0.8999, 0.8845, 0.8492, 0.9019, 0.9465, 0.9355, 0.8827,
         0.8735, 0.9402, 0.9336, 0.9122, 0.8451, 1.0140, 0.8783, 0.8399, 0.8700,
         0.9023, 0.9016, 0.9080, 0.9350, 0.9112, 0.9312, 0.8968, 0.9330, 0.9298,
         0.8941, 0.8438, 0.9544, 0.8715, 0.9142, 0.9181, 0.9489, 0.8762, 0.9989,
         0.9441, 0.9288, 0.9261, 0.9847, 0.9371, 0.9180, 0.9329, 0.8905, 0.8475,
         0.9153, 0.8433, 0.9370, 0.9270, 0.9120, 0.9177, 0.8874, 0.8930, 0.8735,
         0.9847, 0.9387, 0.8646, 0.8262, 0.9190, 0.8807, 0.8959, 0.9056, 0.8214,
         0.8341, 0.8650, 0.8819, 0.8879, 0.8734, 0.8470, 0.8706, 0.9020, 0.9356,
         0.8442, 0.9646, 0.8874, 0.9564, 0.9190, 0.9380, 0.8942, 0.9178, 0.9710,
         0.9474, 0.9280, 0.9695, 0.9391, 0.8690, 0.9598, 0.9898, 0.9259, 1.0142,
         0.9450, 0.8530, 0.8942, 0.9764, 0.8798, 0.8545, 0.9185, 0.8816, 0.8825,
         0.8575, 0.8672, 0.8719, 0.9499, 0.8610, 0.8683, 0.9047, 0.8720, 0.8882,
         0.9069, 0.9666, 0.8317, 0.9331, 0.9398, 0.9003, 0.8598, 0.9437, 0.9088,
         0.8401, 0.9115, 0.8862, 0.9449, 0.9275, 0.8652, 0.9118, 0.8507, 0.9901,
         0.9024, 0.8818, 0.9069, 0.9029, 0.8789, 0.8811, 0.9242, 0.8887, 0.9655,
         0.8954, 0.8576, 0.8258, 0.9606, 0.9177, 0.9271, 0.8449, 0.9577, 0.8939,
         0.8640, 0.8441, 0.9480, 0.8391, 0.9099, 0.8820, 0.9562, 0.8711, 0.9857,
         0.8650, 0.9455, 0.9076, 0.8639, 0.9472, 0.8895, 0.8899, 0.9613, 0.8536,
         0.8410, 0.8751, 0.9867, 0.8433, 0.8359, 0.8871, 0.9283, 0.9143, 0.9309,
         0.9120, 0.9841, 0.8278, 0.8995, 0.8872, 0.9199, 0.9449, 0.8700, 0.9444,
         0.9401, 0.8858, 0.9573, 0.8261, 0.8688, 0.9115, 0.8767, 0.8684, 0.8859,
         0.8313, 0.9028, 0.9002, 0.9361, 0.9204, 0.8675, 0.8823, 0.8912, 0.9636,
         0.8911, 0.8614, 0.9023, 0.8917, 0.8685, 0.9062, 0.9408, 0.8733, 0.9151,
         0.9514, 0.9775, 0.9729, 0.9502, 0.8983, 0.9139, 0.9428, 0.9655, 0.9384,
         0.9592, 0.9125, 0.9205, 0.8661, 0.8689, 0.8781, 0.9335, 0.8305, 0.9088,
         0.8993, 0.8215, 0.8613, 0.7905, 0.8757, 0.8850, 0.9128, 0.8992, 0.9103,
         0.8802, 0.9159, 1.0075, 0.8621, 0.9073, 0.9075, 0.9260, 0.9134, 0.9536,
         0.9308, 0.8855, 0.8849, 0.9416, 0.8803, 0.9295, 0.8571, 0.9316, 0.9107,
         0.9236, 0.8428, 0.8914, 0.9067, 0.8833, 0.9430, 0.9173, 0.8548, 0.9071,
         0.9355, 0.9661, 0.9556, 0.8562, 0.9651, 0.8738, 0.9064, 0.8299, 0.8895,
         0.8683, 0.8117, 0.9205, 0.8762, 0.9554, 0.9135, 0.9255, 0.9286, 0.8714,
         0.9282, 0.9290, 0.9733, 0.8738, 0.9002, 0.8741, 0.8912, 0.9147, 0.9092,
         0.8959, 0.8460, 0.9799, 0.8449, 0.9311, 0.9130, 0.8891, 0.8929, 0.8873,
         0.9273, 0.9140, 0.8620, 0.9394, 0.9448, 0.8426, 0.8658, 0.9067, 0.9603,
         0.9336], grad_fn=&lt;ViewBackward&gt;),
 &#39;sigma&#39;: tensor([4.7574, 5.3869, 4.9623, 5.2321, 5.1119, 5.1875, 4.7274, 5.1041, 4.8586,
         4.8825, 5.1442, 5.0477, 5.2792, 4.8399, 4.9932, 5.4178, 5.3897, 4.8737,
         5.2170, 5.2240, 4.9417, 4.7104, 5.3931, 5.2063, 4.9722, 5.2713, 5.2519,
         5.3068, 4.7052, 5.2009, 4.9776, 4.8524, 5.0937, 4.8937, 4.8932, 5.2773,
         5.0205, 4.8682, 4.8605, 4.8901, 4.8926, 5.2179, 4.7567, 5.3766, 4.9744,
         5.0650, 5.1813, 4.7185, 5.0430, 5.0966, 5.2644, 5.0611, 4.7592, 5.1926,
         4.9806, 4.8434, 5.1897, 5.1083, 5.2032, 4.9105, 5.1968, 4.8454, 5.2884,
         4.7799, 5.2207, 4.9342, 4.7598, 4.9364, 5.2273, 5.0432, 4.9547, 5.2021,
         5.0517, 5.4241, 5.0333, 4.9870, 4.9064, 4.8095, 4.8242, 5.0012, 4.9858,
         5.2095, 4.8268, 5.0973, 5.2964, 4.7593, 4.9848, 5.3265, 5.1684, 5.1044,
         4.9927, 5.3312, 4.9856, 4.9971, 5.0624, 4.9932, 4.9599, 5.1549, 4.8383,
         4.9261, 5.2992, 5.0866, 5.0124, 4.9551, 5.0097, 4.6744, 5.0570, 5.0230,
         4.9091, 5.5178, 5.1421, 5.2597, 5.4421, 5.1976, 5.0229, 5.2767, 5.6337,
         5.0443, 5.2411, 4.9449, 5.1558, 5.1415, 4.9659, 4.8982, 4.8568, 4.9315,
         5.2477, 5.1578, 5.1020, 5.1289, 5.2208, 4.8871, 4.7797, 5.1467, 5.0764,
         5.3092, 5.0234, 5.1574, 5.0060, 5.1018, 4.9507, 5.0715, 5.0342, 5.2516,
         5.0761, 5.3114, 4.9792, 4.9312, 4.8914, 5.1379, 4.9978, 5.2131, 5.0869,
         4.9666, 5.3197, 4.9487, 5.1138, 5.0998, 4.9439, 4.9565, 5.1716, 5.1232,
         5.0301, 5.2395, 5.2559, 5.2593, 5.4147, 5.0920, 4.7726, 5.0113, 5.1791,
         5.3977, 5.2707, 4.7929, 5.1925, 5.2222, 5.1336, 5.0964, 5.2473, 5.2742,
         4.9146, 4.8383, 5.0016, 4.9952, 5.0112, 5.0202, 5.1255, 5.1181, 5.0523,
         5.4333, 5.2639, 4.9311, 4.8304, 4.9594, 5.1610, 5.3081, 4.9718, 4.9574,
         5.2723, 5.2742, 4.9813, 5.1396, 5.4755, 5.0088, 5.1155, 4.9942, 4.9748,
         5.3157, 5.0067, 5.0270, 5.0664, 5.0704, 5.1314, 5.5168, 5.0922, 4.6308,
         5.0780, 5.1925, 4.9475, 4.9314, 5.1161, 4.9857, 5.1406, 5.1080, 5.0676,
         4.9107, 5.4556, 5.2456, 5.1273, 5.0067, 4.7148, 5.1981, 4.7634, 4.8748,
         5.4021, 4.8413, 4.9598, 5.1174, 5.1535, 5.3574, 5.0803, 4.8120, 5.1141,
         5.0565, 5.1699, 5.1913, 5.3080, 5.0115, 4.9949, 4.9920, 5.0349, 5.3851,
         5.1782, 5.3226, 5.0664, 5.2495, 5.0086, 5.1752, 4.9001, 5.4886, 4.7199,
         4.5609, 5.4738, 5.3290, 5.7178, 5.2674, 5.1446, 5.1208, 5.3544, 5.0864,
         5.1854, 5.2822, 4.8306, 4.8024, 5.3826, 5.4075, 4.9452, 5.1063, 5.0749,
         5.1976, 5.0732, 4.9765, 5.1405, 5.2281, 4.8274, 5.0795, 5.1134, 4.9848,
         4.8227, 5.2415, 5.0827, 5.0253, 5.7299, 5.1068, 4.8983, 4.9585, 5.2560,
         5.3980, 4.7488, 4.7617, 5.4101, 5.3294, 5.2216, 5.0704, 5.5149, 5.0015,
         4.7229, 5.1910, 5.1953, 5.4341, 5.2430, 5.1460, 4.7654, 5.1360, 5.2646,
         5.5719, 5.2121, 5.0771, 4.8611, 5.3254, 4.9606, 4.9794, 5.0725, 4.8603,
         5.0699, 5.0861, 4.9501, 5.1943, 4.9581, 5.4192, 5.2334, 5.0530, 4.9230,
         5.2627, 5.0422, 5.0888, 5.2223, 4.7630, 5.2352, 4.8798, 5.3001, 5.0913,
         4.9971, 5.1873, 5.0541, 5.1010, 5.2581, 4.9889, 5.0747, 5.3383, 5.1317,
         4.8678, 4.9797, 4.9692, 4.9797, 4.9835, 5.1723, 4.9804, 5.1572, 4.9808,
         4.8583, 5.1008, 4.9481, 5.4843, 5.3017, 5.1608, 5.1753, 5.1582, 5.0408,
         4.9808, 5.3071, 5.2977, 5.2549, 5.3090, 4.9900, 4.9548, 4.7833, 5.2348,
         5.2448, 5.0823, 5.0069, 5.4104, 5.0197, 5.1651, 4.7643, 5.2850, 5.3806,
         5.1425, 5.3322, 4.6830, 4.8564, 5.2719, 5.2529, 5.0838, 5.0983, 4.7199,
         5.1049, 5.1540, 5.1867, 5.0321, 5.5963, 5.3099, 5.1164, 5.1628, 4.8317,
         5.1328, 4.6457, 4.7853, 5.3249, 4.8817, 5.1824, 4.9979, 5.1332, 5.1309,
         4.8497, 5.0660, 5.4935, 4.9132, 4.8791, 4.7767, 4.7971, 5.4089, 5.3856,
         4.9754, 5.4539, 4.9821, 5.1548, 5.0663, 5.3841, 5.5767, 5.2912, 5.0439,
         5.2179, 5.1710, 5.2219, 5.0679, 5.1476, 5.1466, 5.1591, 5.0676, 4.7828,
         4.7482, 4.9618, 5.3531, 5.0707, 5.1528, 5.1121, 5.2202, 5.3066, 5.0196,
         5.2246, 4.9508, 4.9905, 5.0714, 5.2086, 4.9037, 5.4068, 4.7310, 5.1258,
         5.1330, 4.9411, 5.4253, 4.9811, 5.1956, 5.2587, 5.0770, 4.8994, 5.0870,
         5.2971, 5.0725, 4.7903, 5.0042, 4.8631, 5.3571, 5.1839, 4.8819, 5.2118,
         5.0831, 4.9402, 5.1505, 5.3082, 5.2381, 5.3002, 5.3307, 5.1451, 5.1191,
         4.8234, 5.2885, 5.2080, 4.8160, 5.0798, 4.9129, 5.1272, 5.3949, 4.8799,
         5.0124, 5.1745, 5.1268, 4.9589, 5.3406, 4.6920, 4.8912, 4.9374, 5.2349,
         5.0947, 5.2522, 5.0334, 4.7836, 5.1009, 4.9229, 5.1032, 4.9172, 5.0073,
         4.8525, 5.4204, 4.8287, 5.1259, 5.2811, 4.7472, 5.1167, 5.1254, 4.9172,
         5.1916, 5.0934, 5.2222, 5.4821, 4.9491, 4.4449, 4.8783, 5.0309, 4.9342,
         5.0277, 5.0402, 5.1119, 5.4594, 5.0489, 5.3028, 4.9255, 5.0867, 4.6354,
         4.5178, 4.9976, 4.9252, 5.3254, 4.9562, 5.1591, 5.0996, 4.9850, 5.4780,
         5.2396, 5.2743, 4.9683, 5.1539, 4.9155, 5.2734, 4.9162, 5.2474, 4.9814,
         5.2853, 5.3307, 5.0833, 5.1052, 4.9062, 5.1697, 5.0990, 5.1384, 4.9240,
         4.8825, 5.1520, 5.0756, 4.9370, 5.4202, 4.8609, 4.9003, 5.1759, 5.0394,
         5.1185, 5.1298, 5.1904, 4.7129, 5.1200, 4.9174, 5.1250, 5.1092, 4.9076,
         5.6221, 5.1672, 5.2800, 4.9495, 5.1781, 5.0121, 5.3373, 5.2989, 5.1574,
         4.9583, 4.8745, 5.3501, 5.2267, 5.1809, 5.1423, 4.9972, 4.8345, 5.2709,
         5.3449, 4.8576, 5.1984, 5.0973, 5.1347, 5.0178, 5.3130, 4.7723, 5.4602,
         5.0931, 5.0087, 5.1739, 5.1486, 5.0651, 5.0367, 5.1416, 4.9923, 4.9988,
         5.0102, 5.3030, 5.4030, 5.0672, 4.7882, 5.0714, 5.2843, 4.9654, 5.4038,
         5.0083, 5.4401, 5.1115, 4.5977, 5.1075, 5.1839, 5.1349, 4.8348, 5.1450,
         4.8343, 4.7852, 5.1845, 4.6999, 4.9556, 4.9080, 5.1262, 5.1294, 5.1366,
         4.9648, 4.9008, 5.2832, 5.0567, 4.7639, 5.5476, 4.9573, 5.1825, 4.9738,
         4.9228, 5.2404, 5.0413, 5.0901, 5.2575, 4.9061, 5.3188, 4.8676, 5.0010,
         5.0325, 5.2261, 5.0704, 4.9783, 5.1708, 4.9504, 5.2778, 5.4481, 4.8923,
         5.1619, 5.4647, 5.4015, 4.9336, 5.1807, 5.1331, 5.3072, 5.0893, 5.4008,
         5.0223, 5.2819, 5.3281, 4.7195, 4.5036, 4.7980, 5.0900, 5.1098, 4.7719,
         4.7671, 4.9792, 5.2419, 4.9099, 5.2024, 4.9720, 4.7693, 5.0813, 4.8442,
         5.1206, 5.3540, 4.8681, 5.0851, 5.1147, 4.6583, 4.9062, 5.1068, 5.3250,
         5.1578, 5.2701, 5.2141, 4.8186, 5.1998, 4.7451, 5.2485, 5.0052, 4.7981,
         5.2500, 5.3561, 5.0276, 4.9201, 5.0003, 5.2775, 5.3912, 5.0756, 5.0308,
         5.0285, 5.2373, 5.0918, 5.0650, 5.3713, 5.1036, 4.9463, 5.0482, 5.1675,
         5.2213, 5.0527, 4.9947, 5.4506, 5.3828, 5.0300, 4.6851, 5.1346, 5.3146,
         4.9724, 5.0480, 5.0980, 5.0608, 5.1384, 4.9681, 5.2802, 5.1816, 5.0032,
         5.1328, 5.0865, 5.1765, 5.1976, 5.0773, 4.8920, 5.0722, 5.2044, 5.1823,
         5.2547, 5.1786, 5.1127, 4.9703, 5.5138, 5.3962, 5.0408, 5.0344, 5.4447,
         5.2048, 5.0973, 5.0585, 5.3293, 5.1275, 5.0201, 5.2111, 5.1669, 5.1151,
         4.8817, 5.1183, 5.2401, 4.8881, 5.2865, 5.1156, 4.8257, 5.1157, 5.0345,
         5.6588, 5.0839, 4.9691, 4.9366, 5.4793, 4.9189, 5.0954, 4.8248, 5.0268,
         4.9377, 4.8988, 5.2359, 4.8855, 5.4059, 5.1816, 4.9631, 5.0289, 5.2707,
         5.0809, 4.9781, 5.0615, 5.2667, 5.1047, 4.9706, 5.1076, 4.9888, 5.1212,
         5.1349, 5.0444, 5.0238, 5.2651, 4.5910, 5.0124, 5.1282, 5.0505, 5.1074,
         5.2187, 4.6273, 5.1320, 5.0469, 5.4216, 4.9497, 5.0413, 4.8115, 4.8488,
         4.7681, 5.0492, 4.9737, 4.9650, 4.8861, 4.8799, 4.8452, 5.0890, 4.9526,
         5.1917, 5.3305, 5.4576, 5.0985, 5.2557, 5.4169, 5.3283, 5.0426, 5.1595,
         4.9717, 4.8762, 4.6762, 4.9833, 5.3926, 5.2122, 5.2883, 4.7969, 5.2758,
         5.3698, 5.2123, 4.9759, 5.0392, 5.1047, 5.1741, 5.2335, 4.9166, 4.5892,
         5.2787, 5.0585, 5.1711, 5.3118, 4.9472, 5.1665, 4.9192, 5.1685, 5.6352,
         4.9778, 5.2465, 4.8402, 5.4610, 5.0148, 5.1679, 5.0761, 5.0827, 5.0059,
         5.0517, 4.9994, 5.1800, 4.9046, 5.0609, 4.8888, 5.1086, 5.0904, 5.0245,
         5.0657, 5.2844, 4.9998, 4.7611, 5.2663, 5.0805, 5.0081, 5.2006, 5.3302,
         4.9510, 4.6561, 5.0021, 5.4327, 5.2680, 4.6931, 5.0906, 4.8411, 5.0086,
         5.1588, 4.8974, 5.0853, 5.0475, 5.3434, 5.4719, 5.2079, 5.1548, 5.4057,
         4.8915, 4.8973, 5.1330, 5.2542, 5.1949, 4.9792, 5.0765, 5.2589, 5.0676,
         5.2638, 5.0992, 5.1046, 4.8624, 4.8654, 5.2823, 5.0161, 5.1238, 4.8037,
         5.0039, 5.0600, 4.9676, 5.4605, 4.9099, 5.0849, 5.0597, 5.2635, 5.0039,
         5.0371, 5.1428, 5.1578, 5.3259, 5.0059, 5.1967, 5.2280, 5.2534, 5.1627,
         5.1487, 5.4793, 5.2273, 4.9121, 5.1574, 4.9725, 5.0256, 5.0189, 5.1211,
         5.0362, 5.0441, 5.4066, 4.7991, 5.0927, 4.5886, 4.9554, 4.8912, 5.0269,
         4.8564, 5.0129, 4.7669, 4.7580, 5.2120, 5.2631, 5.3433, 5.0072, 5.3898,
         4.8144, 5.2432, 5.4072, 5.1279, 5.1544, 4.9611, 5.2348, 5.1346, 5.1470,
         5.5651], grad_fn=&lt;ViewBackward&gt;)}
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="code-4-48">
<h1>Code 4.48<a class="headerlink" href="#code-4-48" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">dN</span> <span class="o">=</span> <span class="n">howell2</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">N</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">modelN</span><span class="p">(</span><span class="n">weight_centered</span><span class="p">):</span>

  <span class="n">weight_centered</span> <span class="o">=</span> <span class="n">weight_centered</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
  <span class="n">a</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="mf">178.</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">100.</span><span class="p">)))</span>
  <span class="n">b</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">10.</span><span class="p">)))</span>
  <span class="n">sigma</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;sigma&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">50.</span><span class="p">)))</span>

  <span class="n">height</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">weight_centered</span><span class="p">,</span> <span class="n">sigma</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">height</span> 


<span class="n">howell2_height</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">howell2</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
<span class="n">howell2_weight</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">howell2</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>

<span class="n">conditionedN</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="n">modelN</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">howell2_height</span><span class="p">})</span>
<span class="n">guideN</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">autoguide</span><span class="o">.</span><span class="n">AutoLaplaceApproximation</span><span class="p">(</span><span class="n">conditionedN</span><span class="p">)</span>
<span class="n">pyro</span><span class="o">.</span><span class="n">clear_param_store</span><span class="p">()</span>

<span class="n">svi</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">SVI</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">conditionedN</span><span class="p">,</span>
    <span class="n">guide</span><span class="o">=</span><span class="n">guideN</span><span class="p">,</span>
    <span class="n">optim</span><span class="o">=</span><span class="n">pyro</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">({</span><span class="s2">&quot;lr&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">}),</span>
    <span class="n">loss</span><span class="o">=</span><span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">Trace_ELBO</span><span class="p">(),</span>
<span class="p">)</span>
<span class="n">num_steps</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">losses</span> <span class="o">=</span> <span class="p">[</span><span class="n">svi</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">howell2_weight</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_steps</span><span class="p">)]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">losses</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;ELBO&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;step&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;loss&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">laplace_guideN</span> <span class="o">=</span> <span class="n">guideN</span><span class="o">.</span><span class="n">laplace_approximation</span><span class="p">(</span><span class="n">howell2_weight</span><span class="p">)</span>
<span class="n">predN</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">Predictive</span><span class="p">(</span><span class="n">laplace_guideN</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04_Chapter04_100_0.png" src="../_images/04_Chapter04_100_0.png" />
</div>
</div>
</div>
<div class="section" id="code-4-49">
<h1>Code 4.49<a class="headerlink" href="#code-4-49" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">post</span> <span class="o">=</span> <span class="n">predN</span><span class="o">.</span><span class="n">get_samples</span><span class="p">()</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dN</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">dN</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dN</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span> 
        <span class="n">dN</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">*</span><span class="n">coef_m43_b</span> <span class="o">+</span> <span class="n">coef_m43_a</span><span class="p">,</span>
        <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">dN</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">dN</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">100</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
  <span class="n">b</span> <span class="o">=</span> <span class="n">post</span><span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>
  <span class="n">a</span> <span class="o">=</span> <span class="n">post</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Weight&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Height&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04_Chapter04_102_0.png" src="../_images/04_Chapter04_102_0.png" />
</div>
</div>
</div>
<div class="section" id="code-4-50">
<h1>Code 4.50<a class="headerlink" href="#code-4-50" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mu_at_50</span> <span class="o">=</span> <span class="n">post</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span> <span class="o">+</span> <span class="n">post</span><span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span> <span class="o">*</span> <span class="mi">50</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="code-4-51">
<h1>Code 4.51<a class="headerlink" href="#code-4-51" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">mu_at_50</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;teal&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\mu$ | weight = 50&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Density&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04_Chapter04_106_0.png" src="../_images/04_Chapter04_106_0.png" />
</div>
</div>
</div>
<div class="section" id="code-4-52">
<h1>Code 4.52<a class="headerlink" href="#code-4-52" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stats</span><span class="o">.</span><span class="n">hpdi</span><span class="p">(</span><span class="n">mu_at_50</span><span class="p">,</span> <span class="n">prob</span><span class="o">=</span><span class="mf">0.89</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>tensor([158.5554, 159.6319])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">howell2</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>(352, 5)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pred43</span><span class="o">.</span><span class="n">get_vectorized_trace</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;pyro.poutine.trace_struct.Trace at 0x7fb3b0dec1d0&gt;
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="code-4-53">
<h1>Code 4.53<a class="headerlink" href="#code-4-53" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">link</span><span class="p">(</span><span class="n">laplace_guide</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">num_samples</span><span class="p">):</span>
  <span class="n">pred</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">Predictive</span><span class="p">(</span><span class="n">laplace_guide</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="n">num_samples</span><span class="p">)</span>
  <span class="n">samples</span> <span class="o">=</span> <span class="n">pred</span><span class="o">.</span><span class="n">get_samples</span><span class="p">()</span>
  <span class="n">mu</span> <span class="o">=</span> <span class="n">samples</span><span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">num_samples</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">data</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">samples</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">num_samples</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">mu</span>

<span class="n">mux</span> <span class="o">=</span> <span class="n">link</span><span class="p">(</span><span class="n">laplace_guide43</span><span class="p">,</span> <span class="n">howell2_weight</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">mux</span><span class="p">[:</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>tensor([157.4189, 156.8036, 157.1533, 156.9327, 157.5249])
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="code-4-54">
<h1>Code 4.54<a class="headerlink" href="#code-4-54" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">weight_seq</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">25.</span><span class="p">,</span> <span class="mf">71.</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">mu</span> <span class="o">=</span> <span class="n">link</span><span class="p">(</span><span class="n">laplace_guide43</span><span class="p">,</span> <span class="n">weight_seq</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="code-4-55">
<h1>Code 4.55<a class="headerlink" href="#code-4-55" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="c1">#ax.plot(howell2[&#39;weight&#39;], howell2[&#39;height&#39;])</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">weight_seq</span><span class="p">,</span> <span class="n">mu</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;weight&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04_Chapter04_116_0.png" src="../_images/04_Chapter04_116_0.png" />
</div>
</div>
</div>
<div class="section" id="code-4-56">
<h1>Code 4.56<a class="headerlink" href="#code-4-56" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mu_mean</span> <span class="o">=</span> <span class="n">mu</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">mu_hpdi</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">hpdi</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">prob</span><span class="o">=</span><span class="mf">0.89</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="code-4-57">
<h1>Code 4.57<a class="headerlink" href="#code-4-57" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">howell2</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">],</span> <span class="n">howell2</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">weight_seq</span><span class="p">,</span> <span class="n">mu_mean</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">weight_seq</span><span class="p">,</span> <span class="n">mu_hpdi</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mu_hpdi</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.PolyCollection at 0x7fb3b1224290&gt;
</pre></div>
</div>
<img alt="../_images/04_Chapter04_120_1.png" src="../_images/04_Chapter04_120_1.png" />
</div>
</div>
</div>
<div class="section" id="code-4-58">
<h1>Code 4.58<a class="headerlink" href="#code-4-58" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">post</span> <span class="o">=</span> <span class="n">pred43</span><span class="o">.</span><span class="n">get_samples</span><span class="p">()</span>

<span class="n">weight_seq</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">25.</span><span class="p">,</span> <span class="mf">71.</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">mu</span> <span class="o">=</span> <span class="n">post</span><span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1000</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">weight_seq</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">weight_seq</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">post</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1000</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">mu_mean</span> <span class="o">=</span> <span class="n">mu</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">mu_hpdi</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">hpdi</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">prob</span><span class="o">=</span><span class="mf">0.89</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mu_mean</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>torch.Size([46])
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="code-4-59">
<h1>Code 4.59<a class="headerlink" href="#code-4-59" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">sim</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
  <span class="n">samples</span> <span class="o">=</span> <span class="n">pred</span><span class="o">.</span><span class="n">get_samples</span><span class="p">()</span>
  <span class="n">mu</span> <span class="o">=</span> <span class="n">samples</span><span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">num_samples</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">data</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">samples</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">num_samples</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">mu</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
  <span class="n">sigma</span> <span class="o">=</span> <span class="n">samples</span><span class="p">[</span><span class="s2">&quot;sigma&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">num_samples</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">height_sampled</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> 
                               <span class="n">sigma</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
  <span class="k">return</span> <span class="n">height_sampled</span>

<span class="n">sim_height</span> <span class="o">=</span> <span class="n">sim</span><span class="p">(</span><span class="n">pred43</span><span class="p">,</span> <span class="n">weight_seq</span><span class="p">)</span>
<span class="n">sim_height</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>torch.Size([1000, 46])
</pre></div>
</div>
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>torch.Size([1000, 46])
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="code-4-60">
<h1>Code 4.60<a class="headerlink" href="#code-4-60" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">height_PI</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">pi</span><span class="p">(</span><span class="n">sim_height</span><span class="p">,</span> <span class="n">prob</span><span class="o">=</span><span class="mf">0.89</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">height_PI</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>torch.Size([2, 46])
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="code-4-61">
<h1>Code 4.61<a class="headerlink" href="#code-4-61" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot raw data</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">howell2</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">],</span> <span class="n">howell2</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">weight_seq</span><span class="p">,</span> <span class="n">mu_mean</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">weight_seq</span><span class="p">,</span> <span class="n">mu_hpdi</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mu_hpdi</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">weight_seq</span><span class="p">,</span> <span class="n">height_PI</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">height_PI</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.15</span><span class="p">);</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04_Chapter04_129_0.png" src="../_images/04_Chapter04_129_0.png" />
</div>
</div>
</div>
<div class="section" id="code-4-62">
<h1>Code 4.62<a class="headerlink" href="#code-4-62" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sim_height</span> <span class="o">=</span> <span class="n">sim</span><span class="p">(</span><span class="n">pred43</span><span class="p">,</span> <span class="n">weight_seq</span><span class="p">)</span>
<span class="n">height_PI</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">pi</span><span class="p">(</span><span class="n">sim_height</span><span class="p">,</span> <span class="n">prob</span><span class="o">=</span><span class="mf">0.89</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>torch.Size([1000, 46])
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="code-4-63">
<h1>Code 4.63<a class="headerlink" href="#code-4-63" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># skip</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="code-4-64">
<h1>Code 4.64<a class="headerlink" href="#code-4-64" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">howell</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>height</th>
      <th>weight</th>
      <th>age</th>
      <th>male</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>151.765</td>
      <td>47.825606</td>
      <td>63.0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>139.700</td>
      <td>36.485807</td>
      <td>63.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>136.525</td>
      <td>31.864838</td>
      <td>65.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>156.845</td>
      <td>53.041915</td>
      <td>41.0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>145.415</td>
      <td>41.276872</td>
      <td>51.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>539</th>
      <td>145.415</td>
      <td>31.127751</td>
      <td>17.0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>540</th>
      <td>162.560</td>
      <td>52.163080</td>
      <td>31.0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>541</th>
      <td>156.210</td>
      <td>54.062496</td>
      <td>21.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>542</th>
      <td>71.120</td>
      <td>8.051258</td>
      <td>0.0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>543</th>
      <td>158.750</td>
      <td>52.531624</td>
      <td>68.0</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>544 rows × 4 columns</p>
</div></div></div>
</div>
</div>
<div class="section" id="code-4-65">
<h1>Code 4.65<a class="headerlink" href="#code-4-65" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">howell</span><span class="p">[</span><span class="s1">&#39;weight_s&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">howell</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">howell</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">/</span><span class="n">howell</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="code-4-66">
<h1>Code 4.66<a class="headerlink" href="#code-4-66" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">howell</span><span class="p">[</span><span class="s1">&#39;weight_s2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">howell</span><span class="p">[</span><span class="s1">&#39;weight_s&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>

<span class="k">def</span> <span class="nf">model45</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">weight_s2</span><span class="p">):</span>

  <span class="n">a</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="mf">178.</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">100.</span><span class="p">)))</span>
  <span class="n">b1</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;b1&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">10.</span><span class="p">)))</span>
  <span class="n">b2</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;b2&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">10.</span><span class="p">)))</span>
  <span class="n">sigma</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;sigma&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">50.</span><span class="p">)))</span>
  <span class="n">mu</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b1</span><span class="o">*</span><span class="n">weight</span> <span class="o">+</span> <span class="n">b2</span><span class="o">*</span><span class="n">weight_s2</span>
  <span class="n">height</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">height</span> 

<span class="k">def</span> <span class="nf">guide45</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">weight_s2</span><span class="p">):</span>
  <span class="n">a_param</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;a_param&quot;</span><span class="p">,</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">140.</span><span class="p">))</span>
  <span class="n">b1_param</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;b1_param&quot;</span><span class="p">,</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">10.</span><span class="p">))</span>
  <span class="n">b2_param</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;b2_param&quot;</span><span class="p">,</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">10.</span><span class="p">))</span>
  <span class="n">sigma_param</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;sigma_param&quot;</span><span class="p">,</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">20.</span><span class="p">),</span> <span class="n">constraint</span><span class="o">=</span><span class="n">constraints</span><span class="o">.</span><span class="n">positive</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">(</span><span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Delta</span><span class="p">(</span><span class="n">a_param</span><span class="p">)),</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;b1&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Delta</span><span class="p">(</span><span class="n">b1_param</span><span class="p">)),</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;b2&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Delta</span><span class="p">(</span><span class="n">b2_param</span><span class="p">)),</span> 
          <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;sigma&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Delta</span><span class="p">(</span><span class="n">sigma_param</span><span class="p">)))</span>

<span class="n">howell_height</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">howell</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
<span class="n">howell_weight</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">howell</span><span class="p">[</span><span class="s1">&#39;weight_s&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
<span class="n">howell_weight_s2</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">howell</span><span class="p">[</span><span class="s1">&#39;weight_s2&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>

<span class="n">conditioned45</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="n">model45</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">howell_height</span><span class="p">})</span>
<span class="n">pyro</span><span class="o">.</span><span class="n">clear_param_store</span><span class="p">()</span>
<span class="n">svi</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">SVI</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">conditioned45</span><span class="p">,</span>
    <span class="n">guide</span><span class="o">=</span><span class="n">guide45</span><span class="p">,</span>
    <span class="n">optim</span><span class="o">=</span><span class="n">pyro</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">({</span><span class="s2">&quot;lr&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">}),</span>
    <span class="n">loss</span><span class="o">=</span><span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">Trace_ELBO</span><span class="p">(),</span>
<span class="p">)</span>


<span class="n">num_steps</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">losses</span> <span class="o">=</span> <span class="p">[</span><span class="n">svi</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">howell_weight</span><span class="p">,</span> <span class="n">howell_weight_s2</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_steps</span><span class="p">)]</span>
<span class="n">coef_m45_a</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;a_param&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
<span class="n">coef_m45_b1</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;b1_param&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
<span class="n">coef_m45_b2</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;b2_param&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
<span class="n">coef_m45_sigma</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;sigma_param&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>


<span class="n">guide45</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">autoguide</span><span class="o">.</span><span class="n">AutoLaplaceApproximation</span><span class="p">(</span><span class="n">conditioned45</span><span class="p">)</span>
<span class="n">pyro</span><span class="o">.</span><span class="n">clear_param_store</span><span class="p">()</span>

<span class="n">svi</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">SVI</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">conditioned45</span><span class="p">,</span>
    <span class="n">guide</span><span class="o">=</span><span class="n">guide45</span><span class="p">,</span>
    <span class="n">optim</span><span class="o">=</span><span class="n">pyro</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">({</span><span class="s2">&quot;lr&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">}),</span>
    <span class="n">loss</span><span class="o">=</span><span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">Trace_ELBO</span><span class="p">(),</span>
<span class="p">)</span>
<span class="n">num_steps</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">losses</span> <span class="o">=</span> <span class="p">[</span><span class="n">svi</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">howell_weight</span><span class="p">,</span> <span class="n">howell_weight_s2</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_steps</span><span class="p">)]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">losses</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;ELBO&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;step&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;loss&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">laplace_guide45</span> <span class="o">=</span> <span class="n">guide45</span><span class="o">.</span><span class="n">laplace_approximation</span><span class="p">(</span><span class="n">howell_weight</span><span class="p">,</span> <span class="n">howell_weight_s2</span><span class="p">)</span>
<span class="n">pred45</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">Predictive</span><span class="p">(</span><span class="n">laplace_guide45</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04_Chapter04_139_0.png" src="../_images/04_Chapter04_139_0.png" />
</div>
</div>
</div>
<div class="section" id="code-4-67">
<h1>Code 4.67<a class="headerlink" href="#code-4-67" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">summary</span><span class="p">(</span><span class="n">pred45</span><span class="o">.</span><span class="n">get_samples</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>_AutoMultivariateNormal_latent</th>
      <th>a</th>
      <th>b1</th>
      <th>b2</th>
      <th>sigma</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>mean</th>
      <td>[146.66927, 21.398947, -8.422605, -2.0386057]</td>
      <td>146.66917</td>
      <td>21.39895</td>
      <td>-8.422608</td>
      <td>5.762513</td>
    </tr>
    <tr>
      <th>std</th>
      <td>[0.38244662, 0.28605404, 0.28239244, 0.032499902]</td>
      <td>0.38244662</td>
      <td>0.28605404</td>
      <td>0.28239244</td>
      <td>0.16579546</td>
    </tr>
    <tr>
      <th>5.0%</th>
      <td>[146.02217, 20.92644, -8.913973, -2.0917897]</td>
      <td>146.02217</td>
      <td>20.92644</td>
      <td>-8.913973</td>
      <td>5.494869</td>
    </tr>
    <tr>
      <th>95.0%</th>
      <td>[147.2936, 21.871164, -7.955038, -1.983937]</td>
      <td>147.2936</td>
      <td>21.871164</td>
      <td>-7.955038</td>
      <td>6.044988</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="code-4-68">
<h1>Code 4.68<a class="headerlink" href="#code-4-68" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">link</span><span class="p">(</span><span class="n">laplace_guide</span><span class="p">,</span> <span class="n">data1</span><span class="p">,</span> <span class="n">data2</span><span class="p">,</span> <span class="n">num_samples</span><span class="p">):</span>
  <span class="n">pred</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">Predictive</span><span class="p">(</span><span class="n">laplace_guide</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="n">num_samples</span><span class="p">)</span>
  <span class="n">samples</span> <span class="o">=</span> <span class="n">pred</span><span class="o">.</span><span class="n">get_samples</span><span class="p">()</span>
  <span class="n">mu</span> <span class="o">=</span> <span class="n">samples</span><span class="p">[</span><span class="s2">&quot;b2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">num_samples</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">data2</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">data2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">samples</span><span class="p">[</span><span class="s2">&quot;b1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">num_samples</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">data1</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">data1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">samples</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">num_samples</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">mu</span>

<span class="k">def</span> <span class="nf">sim</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">data1</span><span class="p">,</span> <span class="n">data2</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
  <span class="n">samples</span> <span class="o">=</span> <span class="n">pred</span><span class="o">.</span><span class="n">get_samples</span><span class="p">()</span>
  <span class="n">mu</span> <span class="o">=</span> <span class="n">samples</span><span class="p">[</span><span class="s2">&quot;b2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">num_samples</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">data2</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">data2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">samples</span><span class="p">[</span><span class="s2">&quot;b1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">num_samples</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">data1</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">data1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">samples</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">num_samples</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
  <span class="n">sigma</span> <span class="o">=</span> <span class="n">samples</span><span class="p">[</span><span class="s2">&quot;sigma&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">num_samples</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">height_sampled</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> 
                               <span class="n">sigma</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
  <span class="k">return</span> <span class="n">height_sampled</span>

<span class="n">weight_seq</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">2.2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">mu</span> <span class="o">=</span> <span class="n">link</span><span class="p">(</span><span class="n">laplace_guide45</span><span class="p">,</span> <span class="n">weight_seq</span><span class="p">,</span> <span class="n">weight_seq</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">mu_mean</span> <span class="o">=</span> <span class="n">mu</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">mu_PI</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">pi</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">prob</span><span class="o">=</span><span class="mf">0.89</span><span class="p">)</span>
<span class="n">sim_height</span> <span class="o">=</span> <span class="n">sim</span><span class="p">(</span><span class="n">pred45</span><span class="p">,</span> <span class="n">weight_seq</span><span class="p">,</span> <span class="n">weight_seq</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">height_PI</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">pi</span><span class="p">(</span><span class="n">sim_height</span><span class="p">,</span> <span class="n">prob</span><span class="o">=</span><span class="mf">0.89</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="code-4-69">
<h1>Code 4.69<a class="headerlink" href="#code-4-69" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot raw data</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">howell</span><span class="p">[</span><span class="s2">&quot;weight_s&quot;</span><span class="p">],</span> <span class="n">howell</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">weight_seq</span><span class="p">,</span> <span class="n">mu_mean</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">weight_seq</span><span class="p">,</span> <span class="n">mu_PI</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">mu_PI</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">weight_seq</span><span class="p">,</span> <span class="n">height_PI</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">height_PI</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;weight_s&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04_Chapter04_145_0.png" src="../_images/04_Chapter04_145_0.png" />
</div>
</div>
</div>
<div class="section" id="code-4-70">
<h1>Code 4.70<a class="headerlink" href="#code-4-70" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">howell</span><span class="p">[</span><span class="s1">&#39;weight_s2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">howell</span><span class="p">[</span><span class="s1">&#39;weight_s&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
<span class="n">howell</span><span class="p">[</span><span class="s1">&#39;weight_s3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">howell</span><span class="p">[</span><span class="s1">&#39;weight_s&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">3</span>

<span class="k">def</span> <span class="nf">model46</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">weight_s2</span><span class="p">,</span> <span class="n">weight_s3</span><span class="p">):</span>

  <span class="n">a</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="mf">178.</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">100.</span><span class="p">)))</span>
  <span class="n">b1</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;b1&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">10.</span><span class="p">)))</span>
  <span class="n">b2</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;b2&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">10.</span><span class="p">)))</span>
  <span class="n">b3</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;b3&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">10.</span><span class="p">)))</span>
  <span class="n">sigma</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;sigma&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">50.</span><span class="p">)))</span>
  <span class="n">mu</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b1</span><span class="o">*</span><span class="n">weight</span> <span class="o">+</span> <span class="n">b2</span><span class="o">*</span><span class="n">weight_s2</span> <span class="o">+</span> <span class="n">b3</span><span class="o">*</span><span class="n">weight_s3</span>
  <span class="n">height</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">height</span> 



<span class="n">howell_height</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">howell</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
<span class="n">howell_weight</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">howell</span><span class="p">[</span><span class="s1">&#39;weight_s&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
<span class="n">howell_weight_s2</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">howell</span><span class="p">[</span><span class="s1">&#39;weight_s2&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
<span class="n">howell_weight_s3</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">howell</span><span class="p">[</span><span class="s1">&#39;weight_s3&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>

<span class="n">conditioned46</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="n">model46</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">howell_height</span><span class="p">})</span>
<span class="n">pyro</span><span class="o">.</span><span class="n">clear_param_store</span><span class="p">()</span>

<span class="n">guide46</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">autoguide</span><span class="o">.</span><span class="n">AutoLaplaceApproximation</span><span class="p">(</span><span class="n">conditioned46</span><span class="p">)</span>
<span class="n">pyro</span><span class="o">.</span><span class="n">clear_param_store</span><span class="p">()</span>

<span class="n">svi</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">SVI</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">conditioned46</span><span class="p">,</span>
    <span class="n">guide</span><span class="o">=</span><span class="n">guide46</span><span class="p">,</span>
    <span class="n">optim</span><span class="o">=</span><span class="n">pyro</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">({</span><span class="s2">&quot;lr&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">}),</span>
    <span class="n">loss</span><span class="o">=</span><span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">Trace_ELBO</span><span class="p">(),</span>
<span class="p">)</span>
<span class="n">num_steps</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">losses</span> <span class="o">=</span> <span class="p">[</span><span class="n">svi</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">howell_weight</span><span class="p">,</span> <span class="n">howell_weight_s2</span><span class="p">,</span> <span class="n">howell_weight_s3</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_steps</span><span class="p">)]</span>
<span class="n">laplace_guide46</span> <span class="o">=</span> <span class="n">guide46</span><span class="o">.</span><span class="n">laplace_approximation</span><span class="p">(</span><span class="n">howell_weight</span><span class="p">,</span> <span class="n">howell_weight_s2</span><span class="p">,</span> <span class="n">howell_weight_s3</span><span class="p">)</span>
<span class="n">pred46</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">Predictive</span><span class="p">(</span><span class="n">laplace_guide46</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="code-4-71">
<h1>Code 4.71<a class="headerlink" href="#code-4-71" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">howell</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">],</span> <span class="n">howell</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Weight&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Height&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04_Chapter04_149_0.png" src="../_images/04_Chapter04_149_0.png" />
</div>
</div>
</div>
<div class="section" id="code-4-72">
<h1>Code 4.72<a class="headerlink" href="#code-4-72" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">at</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">at</span> <span class="o">*</span> <span class="n">howell</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">+</span> <span class="n">howell</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">howell</span><span class="p">[</span><span class="s1">&#39;weight_s&#39;</span><span class="p">],</span> <span class="n">howell</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">at</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="nb">round</span><span class="p">(</span><span class="n">label</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">])</span>


<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Weight&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Height&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Height&#39;)
</pre></div>
</div>
<img alt="../_images/04_Chapter04_151_1.png" src="../_images/04_Chapter04_151_1.png" />
</div>
</div>
</div>


              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="03_Chapter03.html" title="previous page">Chapter 03 - Sampling the Imaginary</a>
    <a class='right-next' id="next-link" href="05_Chapter05.html" title="next page">Chapter 05 - Multivariate Linear Models</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Saket Choudhary<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../_static/js/index.js"></script>
    
  </body>
</html>